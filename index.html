<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLASH100 - FASA LASU Academic Support Hub</title>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&family=Playfair+Display:wght@700;900&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
      :root {
    /* Color Palette */
    --primary: #ff8c00;
    --primary-dark: #e67700;
    --primary-light: #ffb84d;
    --secondary: #667eea;
    --accent: #51cf66;
    --danger: #ff6b6b;
    --dark: #1a1a2e;
    --dark-light: #16213e;
    --dark-lighter: #0f3460;

    /* Typography - Fluid scaling */
    --font-display: 'Playfair Display', serif;
    --font-body: 'Montserrat', sans-serif;
    --font-code: 'Fira Code', monospace;

    /* Spacing - Responsive */
    --space-xs: clamp(0.25rem, 1vw, 0.5rem);
    --space-sm: clamp(0.5rem, 2vw, 1rem);
    --space-md: clamp(0.75rem, 3vw, 1.5rem);
    --space-lg: clamp(1rem, 4vw, 2rem);
    --space-xl: clamp(1.5rem, 5vw, 3rem);
    --space-2xl: clamp(2rem, 6vw, 4rem);

    /* Borders - Responsive */
    --radius-sm: clamp(6px, 1.5vw, 8px);
    --radius-md: clamp(8px, 2vw, 12px);
    --radius-lg: clamp(10px, 2.5vw, 16px);
    --radius-xl: clamp(12px, 3vw, 24px);

    /* Shadows */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
    --shadow-glow: 0 0 20px rgba(255, 140, 0, 0.3);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-body);
    background: var(--dark);
    min-height: 100vh;
    color: #fff;
    line-height: 1.6;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Animated Background */
.animated-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
}

.animated-bg::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
        radial-gradient(circle at 20% 50%, rgba(255, 140, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%);
    animation: bgPulse 10s ease-in-out infinite;
}

@keyframes bgPulse {
    0%, 100% {
        opacity: 0.5;
    }
    50% {
        opacity: 1;
    }
}

/* ==================== AUTH SECTION ==================== */
.split-container {
    display: flex;
    min-height: 100vh;
}

.left-section {
    flex: 1;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: clamp(1.5rem, 5vw, 4rem);
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    overflow: hidden;
    min-height: 50vh;
}

.left-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    animation: rotate 30s linear infinite;
}

@keyframes rotate {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

.branding {
    position: relative;
    z-index: 1;
}

.branding h1 {
    font-family: var(--font-display);
    font-size: clamp(1.8rem, 6vw, 4.5rem);
    margin-bottom: var(--space-md);
    font-weight: 900;
    letter-spacing: clamp(-1px, -0.5vw, -2px);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    animation: slideInLeft 0.8s ease-out;
    word-wrap: break-word;
}

.branding p {
    font-size: clamp(0.9rem, 2vw, 1.3rem);
    line-height: 1.8;
    margin-bottom: var(--space-sm);
    opacity: 0.95;
    font-weight: 500;
    animation: slideInLeft 0.8s ease-out 0.2s backwards;
}

.branding .tagline {
    font-size: clamp(0.85rem, 1.8vw, 1.1rem);
    margin-top: var(--space-lg);
    opacity: 0.9;
    line-height: 1.7;
    font-style: italic;
    border-left: 3px solid rgba(255, 255, 255, 0.4);
    padding-left: var(--space-md);
    animation: slideInLeft 0.8s ease-out 0.4s backwards;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.right-section {
    flex: 1;
    padding: clamp(1.5rem, 5vw, 4rem);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--dark);
    min-height: 50vh;
}

.form-wrapper {
    width: 100%;
    max-width: 500px;
    animation: fadeInUp 0.8s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tabs {
    display: flex;
    gap: 0;
    margin-bottom: var(--space-xl);
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--radius-md);
    padding: clamp(4px, 1vw, 8px);
}

.tab {
    flex: 1;
    padding: clamp(10px, 2.5vw, 14px) clamp(12px, 3vw, 20px);
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    font-size: clamp(0.8rem, 2vw, 1rem);
    cursor: pointer;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    border-radius: var(--radius-sm);
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-family: var(--font-body);
}

.tab:hover {
    color: rgba(255, 255, 255, 0.9);
    transform: translateY(-1px);
}

.tab.active {
    color: #fff;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    box-shadow: var(--shadow-glow);
}

.form-content {
    display: none;
}

.form-content.active {
    display: block;
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-group {
    margin-bottom: var(--space-md);
}

.form-group label {
    display: block;
    margin-bottom: var(--space-sm);
    color: rgba(255, 255, 255, 0.85);
    font-size: clamp(0.8rem, 2vw, 0.9rem);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.form-group input {
    width: 100%;
    padding: clamp(12px, 3vw, 16px) clamp(14px, 3.5vw, 18px);
    background: rgba(255, 255, 255, 0.06);
    border: 2px solid rgba(255, 140, 0, 0.2);
    color: #fff;
    font-size: clamp(0.9rem, 2vw, 1rem);
    outline: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: var(--radius-md);
    font-family: var(--font-body);
    -webkit-appearance: none;
    appearance: none;
}

.form-group input:hover {
    border-color: rgba(255, 140, 0, 0.4);
    background: rgba(255, 255, 255, 0.08);
}

.form-group input:focus {
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 15px rgba(255, 140, 0, 0.2);
    transform: translateY(-1px);
}

.form-group input::placeholder {
    color: rgba(255, 255, 255, 0.35);
}

.btn {
    width: 100%;
    padding: clamp(14px, 3vw, 18px);
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border: none;
    color: #fff;
    font-size: clamp(0.9rem, 2vw, 1.05rem);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-top: var(--space-md);
    border-radius: var(--radius-md);
    text-transform: uppercase;
    letter-spacing: clamp(0.5px, 0.2vw, 1px);
    box-shadow: var(--shadow-md);
    font-family: var(--font-body);
    position: relative;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn:hover {
    background: linear-gradient(135deg, #ff9d1a 0%, #f07d00 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
}

.btn:active {
    transform: translateY(0);
}

.message {
    padding: clamp(12px, 3vw, 16px) clamp(14px, 3.5vw, 20px);
    margin-bottom: var(--space-lg);
    border-left: 3px solid var(--primary);
    background: rgba(255, 140, 0, 0.12);
    color: var(--primary-light);
    display: none;
    border-radius: var(--radius-sm);
    font-weight: 500;
    animation: slideDown 0.3s ease;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

.message.show {
    display: block;
}

.message.error {
    border-left-color: var(--danger);
    background: rgba(255, 107, 107, 0.12);
    color: #ff8787;
}

.message.success {
    border-left-color: var(--accent);
    background: rgba(81, 207, 102, 0.12);
    color: #69db7c;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==================== DASHBOARD ==================== */
.dashboard {
    display: none;
    min-height: 100vh;
    background: transparent;
}

.dashboard.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

.dashboard-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: clamp(0.75rem, 2.5vw, 1.5rem) clamp(1rem, 4vw, 3rem);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-sm);
    box-shadow: var(--shadow-lg);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.dashboard-header h2 {
    font-family: var(--font-display);
    font-size: clamp(1.2rem, 4vw, 2rem);
    font-weight: 900;
    word-wrap: break-word;
}

.logout-btn,
.action-btn {
    padding: clamp(10px, 2vw, 12px) clamp(16px, 4vw, 28px);
    background: var(--dark);
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: clamp(0.85rem, 2vw, 1rem);
    font-weight: 600;
    border-radius: var(--radius-sm);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: var(--font-body);
    -webkit-tap-highlight-color: transparent;
    white-space: nowrap;
}

.logout-btn:hover,
.action-btn:hover {
    background: var(--dark-lighter);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.dashboard-content {
    padding: clamp(1rem, 4vw, 3rem);
    max-width: 1400px;
    margin: 0 auto;
}

/* ==================== NAVIGATION TABS ==================== */
.nav-tabs {
    display: flex;
    gap: var(--space-sm);
    margin-bottom: var(--space-xl);
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) rgba(255, 255, 255, 0.1);
    padding-bottom: var(--space-sm);
    -webkit-overflow-scrolling: touch;
}

.nav-tabs::-webkit-scrollbar {
    height: clamp(4px, 1vw, 6px);
}

.nav-tabs::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.nav-tabs::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

.nav-tab {
    padding: clamp(10px, 2.5vw, 14px) clamp(16px, 4vw, 24px);
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 140, 0, 0.2);
    color: rgba(255, 255, 255, 0.7);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    white-space: nowrap;
    font-family: var(--font-body);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: clamp(0.85rem, 2vw, 1rem);
    -webkit-tap-highlight-color: transparent;
}

.nav-tab:hover {
    border-color: var(--primary);
    color: #fff;
    transform: translateY(-1px);
}

.nav-tab.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-color: var(--primary);
    color: #fff;
    box-shadow: var(--shadow-glow);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

/* ==================== CARDS ==================== */
.card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.2);
    border-radius: var(--radius-lg);
    padding: clamp(1rem, 4vw, 1.5rem);
    margin-bottom: var(--space-lg);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
}

.card:hover {
    border-color: var(--primary);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-md);
    border-bottom: 2px solid rgba(255, 140, 0, 0.2);
}

.card-title {
    font-family: var(--font-display);
    color: var(--primary);
    font-size: clamp(1.1rem, 3vw, 1.8rem);
    font-weight: 700;
    word-wrap: break-word;
}

/* ==================== STUDY TIMER ==================== */
.timer-container {
    text-align: center;
    padding: clamp(1.5rem, 5vw, 3rem);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(255, 140, 0, 0.1) 100%);
    border-radius: var(--radius-xl);
    margin-bottom: var(--space-xl);
}

.timer-display {
    font-family: var(--font-code);
    font-size: clamp(2.5rem, 12vw, 6rem);
    font-weight: 700;
    color: var(--primary);
    text-shadow: 0 0 20px rgba(255, 140, 0, 0.5);
    margin: var(--space-lg) 0;
    letter-spacing: 0.08em;
}

.timer-controls {
    display: flex;
    gap: var(--space-md);
    justify-content: center;
    flex-wrap: wrap;
}

.timer-btn {
    padding: clamp(12px, 3vw, 16px) clamp(20px, 5vw, 32px);
    background: linear-gradient(135deg, var(--secondary) 0%, #764ba2 100%);
    color: #fff;
    border: none;
    border-radius: var(--radius-md);
    font-size: clamp(0.95rem, 2vw, 1.1rem);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: var(--font-body);
    -webkit-tap-highlight-color: transparent;
}

.timer-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.timer-btn:active {
    transform: translateY(0);
}

.timer-btn.danger {
    background: linear-gradient(135deg, var(--danger) 0%, #c92a2a 100%);
}

/* ==================== AI CHAT ==================== */
.ai-chat-container {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 140, 0, 0.2);
    border-radius: var(--radius-lg);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: clamp(400px, 70vh, 600px);
}

.ai-chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: clamp(0.75rem, 3vw, 1.5rem);
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    -webkit-overflow-scrolling: touch;
}

.ai-message {
    padding: clamp(0.75rem, 3vw, 1rem);
    border-radius: var(--radius-md);
    max-width: 85%;
    animation: messageSlideIn 0.3s ease;
    word-wrap: break-word;
    overflow-wrap: break-word;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

@keyframes messageSlideIn {
    from {
        opacity: 0;
        transform: translateX(-15px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.ai-message.user {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    align-self: flex-end;
    margin-left: auto;
}

.ai-message.assistant {
    background: rgba(255, 255, 255, 0.1);
    align-self: flex-start;
    border-left: 3px solid var(--secondary);
}

.ai-chat-input-container {
    padding: clamp(0.75rem, 3vw, 1rem);
    background: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 140, 0, 0.2);
    display: flex;
    gap: var(--space-sm);
}

.ai-chat-input {
    flex: 1;
    padding: clamp(10px, 2.5vw, 14px) clamp(12px, 3vw, 18px);
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 140, 0, 0.2);
    color: #fff;
    border-radius: var(--radius-md);
    font-family: var(--font-body);
    font-size: clamp(0.85rem, 2vw, 1rem);
    outline: none;
    transition: all 0.3s;
    -webkit-appearance: none;
}

.ai-chat-input:focus {
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.08);
}

.ai-send-btn {
    padding: clamp(10px, 2.5vw, 14px) clamp(16px, 4vw, 28px);
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: #fff;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-family: var(--font-body);
    font-size: clamp(0.85rem, 2vw, 1rem);
    -webkit-tap-highlight-color: transparent;
}

.ai-send-btn:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-glow);
}

.ai-send-btn:active {
    transform: scale(1);
}

/* ==================== COMMUNITY ==================== */
.community-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(clamp(200px, 40vw, 280px), 1fr));
    gap: clamp(1rem, 3vw, 1.5rem);
    margin-top: var(--space-lg);
}

.community-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.2);
    border-radius: var(--radius-lg);
    padding: clamp(1rem, 4vw, 1.5rem);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
}

.community-card:hover {
    border-color: var(--primary);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.community-icon {
    font-size: clamp(2rem, 6vw, 3rem);
    margin-bottom: var(--space-md);
    display: block;
}

.community-name {
    font-size: clamp(1.1rem, 3vw, 1.3rem);
    font-weight: 700;
    color: var(--primary);
    margin-bottom: var(--space-sm);
    font-family: var(--font-display);
    word-wrap: break-word;
}

.community-stats {
    display: flex;
    gap: var(--space-md);
    font-size: clamp(0.8rem, 2vw, 0.9rem);
    color: rgba(255, 255, 255, 0.6);
    flex-wrap: wrap;
}

/* ==================== POSTS ==================== */
.post {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.2);
    border-radius: var(--radius-lg);
    padding: clamp(1rem, 4vw, 1.5rem);
    margin-bottom: var(--space-lg);
    transition: all 0.3s;
}

.post:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-md);
}

.post-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-md);
    flex-wrap: wrap;
}

.post-avatar {
    width: clamp(40px, 8vw, 48px);
    height: clamp(40px, 8vw, 48px);
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    flex-shrink: 0;
}

.post-meta {
    flex: 1;
    min-width: 0;
}

.post-author {
    font-weight: 600;
    color: var(--primary);
    font-size: clamp(0.9rem, 2vw, 1rem);
    word-wrap: break-word;
}

.post-time {
    font-size: clamp(0.75rem, 1.8vw, 0.85rem);
    color: rgba(255, 255, 255, 0.5);
}

.post-content {
    margin-bottom: var(--space-md);
    line-height: 1.8;
    font-size: clamp(0.85rem, 2vw, 1rem);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.post-actions {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.post-action-btn {
    padding: clamp(6px, 1.5vw, 8px) clamp(12px, 3vw, 16px);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.2);
    color: rgba(255, 255, 255, 0.7);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.3s;
    font-family: var(--font-body);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: clamp(0.8rem, 1.8vw, 0.9rem);
    -webkit-tap-highlight-color: transparent;
}

.post-action-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--primary);
    border-color: var(--primary);
}

.post-action-btn:active {
    transform: scale(0.98);
}

/* ==================== COURSE OUTLINE ==================== */
.outline-item {
    background: rgba(255, 255, 255, 0.03);
    border-left: 3px solid var(--primary);
    padding: clamp(0.75rem, 3vw, 1rem);
    margin-bottom: var(--space-md);
    border-radius: var(--radius-sm);
    transition: all 0.3s;
}

.outline-item:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(3px);
}

.outline-week {
    font-weight: 700;
    color: var(--primary);
    margin-bottom: var(--space-xs);
    font-family: var(--font-display);
    font-size: clamp(0.95rem, 2vw, 1.1rem);
}

.outline-topics {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.6;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

/* ==================== MODALS ==================== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 2000;
    overflow-y: auto;
    animation: fadeIn 0.3s ease;
    -webkit-overflow-scrolling: touch;
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: clamp(1rem, 3vw, 1.5rem);
}

.modal-content {
    background: var(--dark);
    border: 1px solid rgba(255, 140, 0, 0.3);
    border-radius: var(--radius-xl);
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: clamp(1rem, 4vw, 1.5rem) clamp(1.5rem, 5vw, 3rem);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-sm);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    position: sticky;
    top: 0;
    z-index: 10;
}

.modal-header h3 {
    font-family: var(--font-display);
    font-size: clamp(1.2rem, 4vw, 2rem);
    margin: 0;
    word-wrap: break-word;
}

.close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    font-size: clamp(1.8rem, 5vw, 2.5rem);
    cursor: pointer;
    padding: 0;
    width: clamp(40px, 10vw, 50px);
    height: clamp(40px, 10vw, 50px);
    line-height: 1;
    transition: all 0.3s;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg) scale(1.1);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
}

.close-btn:active {
    transform: rotate(90deg) scale(0.95);
}

.modal-body {
    padding: clamp(1.5rem, 5vw, 3rem);
}

/* ==================== RESOURCES ==================== */
.resource-tab.active {
    color: var(--primary) !important;
    background: rgba(255, 140, 0, 0.05);
    position: relative;
}

.resource-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--primary);
}

.resource-tab:hover {
    color: rgba(255, 255, 255, 0.8);
}

.resource-item {
    background: rgba(255, 140, 0, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.3);
    padding: clamp(12px, 3vw, 20px);
    border-left: 3px solid var(--primary);
    border-radius: var(--radius-md);
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin-bottom: var(--space-md);
    transition: all 0.3s;
}

.resource-item:hover {
    background: rgba(255, 140, 0, 0.1);
    transform: translateX(3px);
    box-shadow: var(--shadow-md);
}

.resource-item h4 {
    font-size: clamp(0.95rem, 2.5vw, 1.3rem);
    word-break: break-word;
    margin-bottom: var(--space-sm);
    color: var(--primary);
    font-family: var(--font-display);
}

.resource-item p {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: var(--space-sm);
    line-height: 1.6;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

.resource-actions {
    display: flex;
    gap: var(--space-sm);
    margin-top: var(--space-md);
    flex-wrap: wrap;
}

.resource-btn {
    padding: clamp(8px, 2vw, 10px) clamp(14px, 3vw, 20px);
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-family: var(--font-body);
    display: inline-flex;
    align-items: center;
    gap: clamp(4px, 1vw, 8px);
    font-size: clamp(0.8rem, 2vw, 0.95rem);
    -webkit-tap-highlight-color: transparent;
}

.resource-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.resource-btn:active {
    transform: translateY(0);
}

.resource-btn.secondary {
    background: var(--secondary);
}

.resource-btn.secondary:hover {
    background: #5568d3;
}

.category-badge {
    display: inline-block;
    padding: clamp(4px, 1vw, 6px) clamp(10px, 2vw, 14px);
    background: rgba(255, 140, 0, 0.2);
    color: var(--primary);
    font-size: clamp(0.75rem, 1.8vw, 0.85rem);
    border-radius: var(--radius-sm);
    margin-right: var(--space-xs);
    margin-top: var(--space-xs);
    font-weight: 600;
}

/* Department Tab Styling */
.dept-tab:hover {
    background: rgba(255, 140, 0, 0.4) !important;
    border-color: var(--primary) !important;
}

.dept-tab.active {
    background: var(--primary) !important;
    color: var(--dark) !important;
    border-color: var(--primary) !important;
}

/* ==================== FILE VIEWER MODAL ==================== */
.file-viewer-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 3000;
    overflow: hidden;
}

.file-viewer-modal.active {
    display: flex;
    flex-direction: column;
    animation: fadeIn 0.3s ease;
}

.file-viewer-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: clamp(10px, 2.5vw, 20px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: clamp(8px, 2vw, 15px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.file-viewer-title {
    color: #fff;
    font-size: clamp(0.9rem, 3vw, 1.4rem);
    font-weight: 700;
    font-family: var(--font-display);
    flex: 1 1 150px;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin: 0;
}

.file-viewer-controls {
    display: flex;
    gap: clamp(6px, 1.5vw, 12px);
    align-items: center;
    flex-wrap: wrap;
}

.font-control {
    display: flex;
    align-items: center;
    gap: clamp(4px, 1vw, 10px);
    background: rgba(255, 255, 255, 0.15);
    padding: clamp(6px, 1.5vw, 10px) clamp(8px, 2vw, 14px);
    border-radius: clamp(6px, 1.5vw, 8px);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.font-control label {
    color: #fff;
    font-size: clamp(0.7rem, 2vw, 0.95rem);
    font-weight: 600;
    white-space: nowrap;
    margin: 0;
}

.font-control select,
.font-control input {
    background: rgba(255, 255, 255, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    padding: clamp(4px, 1vw, 8px) clamp(6px, 1.5vw, 12px);
    border-radius: clamp(4px, 1vw, 6px);
    font-family: var(--font-body);
    font-size: clamp(0.7rem, 2vw, 0.9rem);
    outline: none;
    transition: all 0.3s;
    -webkit-appearance: none;
}

.font-control select:focus,
.font-control input:focus {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
}

.font-control select option {
    background: var(--dark);
    color: #fff;
}

.font-control input[type="number"] {
    width: clamp(45px, 12vw, 70px);
    text-align: center;
}

.file-viewer-body {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: clamp(10px, 3vw, 25px);
    background: var(--dark);
    -webkit-overflow-scrolling: touch;
}

.file-viewer-body::-webkit-scrollbar {
    width: clamp(6px, 1.5vw, 12px);
}

.file-viewer-body::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

.file-viewer-body::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

.file-viewer-body::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

.file-content {
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 140, 0, 0.3);
    border-radius: clamp(8px, 2vw, 16px);
    padding: clamp(15px, 4vw, 35px);
    color: rgba(255, 255, 255, 0.95);
    line-height: 1.8;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    font-family: 'Georgia', serif;
    font-size: clamp(14px, 3vw, 16px);
    max-width: 1000px;
    margin: 0 auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    min-height: 200px;
}

.loading-spinner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: clamp(40px, 8vw, 80px) clamp(15px, 3vw, 30px);
    color: var(--primary);
}

.loading-spinner .spinner {
    width: clamp(35px, 10vw, 60px);
    height: clamp(35px, 10vw, 60px);
    border: 3px solid rgba(255, 140, 0, 0.2);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.loading-spinner p {
    margin-top: clamp(12px, 3vw, 25px);
    font-size: clamp(0.9rem, 2.5vw, 1.2rem);
    font-weight: 600;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* ==================== UTILITY CLASSES ==================== */
.text-center {
    text-align: center;
}

.mb-1 {
    margin-bottom: var(--space-xs);
}

.mb-2 {
    margin-bottom: var(--space-sm);
}

.mb-3 {
    margin-bottom: var(--space-md);
}

.mb-4 {
    margin-bottom: var(--space-lg);
}

.mt-1 {
    margin-top: var(--space-xs);
}

.mt-2 {
    margin-top: var(--space-sm);
}

.mt-3 {
    margin-top: var(--space-md);
}

.mt-4 {
    margin-top: var(--space-lg);
}

.flex {
    display: flex;
}

.flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

.flex-between {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.flex-wrap {
    flex-wrap: wrap;
}

.gap-1 {
    gap: var(--space-xs);
}

.gap-2 {
    gap: var(--space-sm);
}

.gap-3 {
    gap: var(--space-md);
}

.loading {
    display: inline-block;
    width: clamp(16px, 4vw, 20px);
    height: clamp(16px, 4vw, 20px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s linear infinite;
}

/* Global Scrollbar Styling */
::-webkit-scrollbar {
    width: clamp(8px, 1.5vw, 10px);
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* ==================== RESPONSIVE BREAKPOINTS ==================== */

/* Large Tablets and Small Desktops */
@media (max-width: 1024px) {
    .split-container {
        flex-direction: column;
    }

    .left-section,
    .right-section {
        flex: none;
        width: 100%;
    }

    .left-section {
        min-height: 40vh;
    }

    .community-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    }
}

/* Tablets (Portrait) */
@media (max-width: 768px) {
    :root {
        --space-xs: clamp(0.25rem, 1vw, 0.4rem);
        --space-sm: clamp(0.5rem, 2vw, 0.8rem);
        --space-md: clamp(0.75rem, 3vw, 1.2rem);
        --space-lg: clamp(1rem, 4vw, 1.6rem);
        --space-xl: clamp(1.25rem, 5vw, 2rem);
    }

    .dashboard-header {
        flex-direction: column;
        align-items: stretch;
    }

    .dashboard-header h2 {
        text-align: center;
        margin-bottom: var(--space-sm);
    }

    .logout-btn,
    .action-btn {
        width: 100%;
    }

    .community-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }

    .ai-chat-container {
        height: clamp(350px, 60vh, 500px);
    }

    .file-viewer-title {
        flex: 1 1 100%;
        text-align: center;
        margin-bottom: var(--space-xs);
    }

    .file-viewer-controls {
        flex: 1 1 100%;
        justify-content: center;
    }
}

/* Mobile Phones (Portrait) */
@media (max-width: 480px) {
    .modal-content {
        border-radius: var(--radius-md);
        max-height: 95vh;
        margin: var(--space-sm);
    }

    .community-grid {
        grid-template-columns: 1fr;
    }

    .post-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .post-avatar {
        margin-bottom: var(--space-sm);
    }

    .timer-controls {
        width: 100%;
    }

    .timer-btn {
        flex: 1;
        min-width: 120px;
    }

    .nav-tabs {
        gap: var(--space-xs);
    }

    .nav-tab {
        font-size: clamp(0.75rem, 2.5vw, 0.9rem);
        padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 18px);
    }

    .resource-actions {
        flex-direction: column;
    }

    .resource-btn {
        width: 100%;
        justify-content: center;
    }

    .file-viewer-header {
        padding: 12px 10px;
    }

    .file-viewer-title {
        order: 1;
        font-size: clamp(0.85rem, 3vw, 1rem);
    }

    .close-btn {
        order: 3;
        width: clamp(35px, 10vw, 40px);
        height: clamp(35px, 10vw, 40px);
    }

    .file-viewer-controls {
        order: 2;
        width: 100%;
        justify-content: space-between;
    }

    .font-control {
        flex: 1 1 calc(50% - 5px);
        min-width: 0;
        padding: clamp(5px, 1.5vw, 8px);
    }

    .font-control label {
        font-size: clamp(0.65rem, 2vw, 0.75rem);
    }

    .tabs {
        flex-direction: column;
    }

    .tab {
        width: 100%;
    }
}

/* Extra Small Mobile Devices */
@media (max-width: 360px) {
    .branding h1 {
        font-size: clamp(1.5rem, 8vw, 2rem);
    }

    .file-content {
        padding: clamp(10px, 3vw, 12px);
        font-size: clamp(13px, 3.5vw, 14px);
    }

    .font-control label {
        display: none;
    }

    .font-control select,
    .font-control input {
        width: 100%;
    }

    .ai-message {
        max-width: 95%;
    }

    .card {
        padding: clamp(0.75rem, 3vw, 1rem);
    }
}

/* Landscape Mode for Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .split-container {
        flex-direction: row;
    }

    .left-section {
        min-height: 100vh;
    }

    .file-viewer-header {
        padding: 8px 12px;
    }

    .file-viewer-body {
        padding: 10px 15px;
    }

    .timer-display {
        font-size: clamp(2rem, 8vw, 3rem);
        margin: var(--space-sm) 0;
    }

    .ai-chat-container {
        height: 80vh;
    }
}

/* iPhone X, 11, 12, 13, 14 Series */
@media (max-width: 428px) {
    body {
        padding-bottom: env(safe-area-inset-bottom);
    }

    .dashboard-header {
        padding-top: max(env(safe-area-inset-top), var(--space-md));
    }

    .modal.active {
        padding-bottom: env(safe-area-inset-bottom);
    }
}

/* iPhone SE and older small devices */
@media (max-width: 375px) {
    .community-card {
        padding: clamp(0.75rem, 3vw, 1rem);
    }

    .post {
        padding: clamp(0.75rem, 3vw, 1rem);
    }

    .card-title {
        font-size: clamp(1rem, 3vw, 1.2rem);
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    .file-content {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 140, 0, 0.4);
        color: rgba(255, 255, 255, 0.98);
    }
}

/* Print Styles */
@media print {
    .file-viewer-header,
    .file-viewer-controls,
    .close-btn,
    .dashboard-header,
    .nav-tabs,
    .logout-btn,
    .action-btn {
        display: none !important;
    }

    .file-viewer-modal,
    body {
        background: white;
    }

    .file-content {
        background: white;
        color: black;
        border: none;
        box-shadow: none;
        padding: 20px;
    }

    .dashboard-content {
        padding: 20px;
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    .card,
    .post,
    .community-card,
    .resource-item {
        border-width: 2px;
        border-color: var(--primary);
    }

    .btn,
    .timer-btn,
    .resource-btn {
        border: 2px solid var(--primary-light);
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .btn,
    .timer-btn,
    .resource-btn,
    .post-action-btn,
    .nav-tab,
    .tab,
    .logout-btn,
    .action-btn {
        min-height: 44px;
        min-width: 44px;
    }

    .close-btn {
        min-width: 44px;
        min-height: 44px;
    }

    .form-group input,
    .ai-chat-input {
        min-height: 44px;
    }
}
/* ==================== FULL-PAGE DEPARTMENT MODAL STYLES ==================== */
/* ==================== FULL-PAGE DEPARTMENT MODAL STYLES ==================== */

/* Base Modal - Full Screen Coverage */
#departmentModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--dark);
    z-index: 9999;
    overflow: hidden;
    animation: fadeIn 0.3s ease;
}

#departmentModal.active {
    display: flex;
    flex-direction: column;
}

/* Modal Header - Sticky at Top */
#departmentModal .modal-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: clamp(15px, 3vw, 25px) clamp(20px, 4vw, 40px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: clamp(10px, 2vw, 15px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: sticky;
    top: 0;
    z-index: 100;
    min-height: clamp(60px, 10vh, 80px);
}

#deptModalTitle {
    color: #fff;
    font-size: clamp(1.1rem, 4vw, 1.8rem);
    font-weight: 700;
    font-family: var(--font-display);
    margin: 0;
    flex: 1 1 200px;
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
}

#deptModalTitle i {
    font-size: clamp(1.2rem, 4vw, 2rem);
}

/* Search Bar in Header */
#departmentModal .modal-header input[type="text"] {
    flex: 1 1 250px;
    max-width: 400px;
    padding: clamp(10px, 2vw, 14px) clamp(12px, 3vw, 18px);
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    border-radius: clamp(8px, 2vw, 12px);
    font-size: clamp(0.85rem, 2vw, 1rem);
    font-family: var(--font-body);
    outline: none;
    transition: all 0.3s;
}

#departmentModal .modal-header input[type="text"]:focus {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
}

#departmentModal .modal-header input[type="text"]::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* Close Button */
#departmentModal .close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    font-size: clamp(1.8rem, 5vw, 2.5rem);
    cursor: pointer;
    padding: 0;
    width: clamp(40px, 10vw, 55px);
    height: clamp(40px, 10vw, 55px);
    line-height: 1;
    transition: all 0.3s;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
}

#departmentModal .close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg) scale(1.1);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
}

#departmentModal .close-btn:active {
    transform: rotate(90deg) scale(0.95);
}

/* Modal Body - Scrollable Content Area */
#departmentModal .modal-body {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: clamp(15px, 4vw, 30px);
    background: var(--dark);
    -webkit-overflow-scrolling: touch;
}

#departmentModal .modal-body::-webkit-scrollbar {
    width: clamp(8px, 1.5vw, 12px);
}

#departmentModal .modal-body::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

#departmentModal .modal-body::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

#departmentModal .modal-body::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* Resource Type Tabs */
.resource-tabs {
    display: flex;
    gap: clamp(8px, 2vw, 15px);
    margin-bottom: clamp(20px, 4vw, 30px);
    padding-bottom: clamp(10px, 2vw, 15px);
    border-bottom: 2px solid rgba(255, 140, 0, 0.2);
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) rgba(255, 255, 255, 0.1);
    -webkit-overflow-scrolling: touch;
}

.resource-tabs::-webkit-scrollbar {
    height: clamp(4px, 1vw, 6px);
}

.resource-tabs::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.resource-tabs::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

.resource-tab {
    padding: clamp(10px, 2.5vw, 14px) clamp(20px, 4vw, 30px);
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 140, 0, 0.2);
    color: rgba(255, 255, 255, 0.7);
    border-radius: clamp(8px, 2vw, 12px);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    font-size: clamp(0.85rem, 2vw, 1rem);
    font-family: var(--font-body);
    white-space: nowrap;
    position: relative;
    -webkit-tap-highlight-color: transparent;
}

.resource-tab:hover {
    background: rgba(255, 140, 0, 0.1);
    border-color: var(--primary);
    color: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
}

.resource-tab.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-color: var(--primary);
    color: #fff;
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
}

/* Resource Content Tabs */
.resource-content-tab {
    display: none;
}

.resource-content-tab.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

/* Resource Lists */
#pastQuestionsList,
#otherResourcesList {
    display: grid;
    gap: clamp(15px, 3vw, 25px);
}

/* Individual Resource Items - Already styled in main CSS but ensuring full responsiveness */
#departmentModal .resource-item {
    background: rgba(255, 140, 0, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.3);
    padding: clamp(15px, 4vw, 25px);
    border-left: 4px solid var(--primary);
    border-radius: clamp(10px, 2vw, 16px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#departmentModal .resource-item:hover {
    background: rgba(255, 140, 0, 0.1);
    transform: translateX(5px);
    box-shadow: 0 4px 20px rgba(255, 140, 0, 0.2);
}

#departmentModal .resource-item h4 {
    font-size: clamp(1rem, 3vw, 1.3rem);
    color: var(--primary);
    margin-bottom: clamp(8px, 2vw, 12px);
    font-family: var(--font-display);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

#departmentModal .resource-item p {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: clamp(6px, 1.5vw, 10px);
    line-height: 1.6;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

#departmentModal .resource-actions {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    margin-top: clamp(12px, 3vw, 18px);
    flex-wrap: wrap;
}

#departmentModal .resource-btn {
    padding: clamp(8px, 2vw, 12px) clamp(16px, 3vw, 24px);
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: clamp(6px, 1.5vw, 10px);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-family: var(--font-body);
    display: inline-flex;
    align-items: center;
    gap: clamp(6px, 1.5vw, 10px);
    font-size: clamp(0.8rem, 2vw, 0.95rem);
    -webkit-tap-highlight-color: transparent;
    flex: 1 1 auto;
    justify-content: center;
    min-height: 44px;
}

#departmentModal .resource-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
}

#departmentModal .resource-btn:active {
    transform: translateY(0);
}

#departmentModal .resource-btn.secondary {
    background: var(--secondary);
}

#departmentModal .resource-btn.secondary:hover {
    background: #5568d3;
}

#departmentModal .category-badge {
    display: inline-block;
    padding: clamp(4px, 1vw, 6px) clamp(10px, 2vw, 14px);
    background: rgba(255, 140, 0, 0.2);
    color: var(--primary);
    font-size: clamp(0.75rem, 1.8vw, 0.85rem);
    border-radius: clamp(4px, 1vw, 6px);
    margin-right: clamp(6px, 1.5vw, 10px);
    margin-top: clamp(4px, 1vw, 6px);
    font-weight: 600;
}

/* Empty State */
#departmentModal .empty-state {
    text-align: center;
    padding: clamp(40px, 8vw, 80px) clamp(20px, 4vw, 40px);
    color: rgba(255, 255, 255, 0.5);
}

#departmentModal .empty-state i {
    font-size: clamp(3rem, 8vw, 5rem);
    margin-bottom: clamp(15px, 3vw, 25px);
    color: rgba(255, 140, 0, 0.3);
}

/* ==================== RESPONSIVE BREAKPOINTS ==================== */

/* Large Tablets */
@media (max-width: 1024px) {
    #departmentModal .modal-header {
        flex-direction: column;
        align-items: stretch;
    }

    #deptModalTitle {
        text-align: center;
        justify-content: center;
        order: 1;
        flex: 1 1 100%;
    }

    #departmentModal .modal-header input[type="text"] {
        order: 2;
        max-width: 100%;
        flex: 1 1 100%;
    }

    #departmentModal .close-btn {
        order: 3;
        align-self: center;
    }
}

/* Tablets (Portrait) */
@media (max-width: 768px) {
    #departmentModal .modal-header {
        padding: 15px 20px;
    }

    #departmentModal .modal-body {
        padding: 15px;
    }

    .resource-tabs {
        gap: 10px;
        margin-bottom: 20px;
    }

    .resource-tab {
        font-size: 0.85rem;
        padding: 10px 16px;
    }

    #departmentModal .resource-actions {
        flex-direction: column;
    }

    #departmentModal .resource-btn {
        width: 100%;
        flex: 1 1 100%;
    }
}

/* Mobile Phones (Portrait) */
@media (max-width: 480px) {
    #departmentModal .modal-header {
        padding: 12px 15px;
        min-height: 60px;
    }

    #deptModalTitle {
        font-size: 1rem;
        margin-bottom: 10px;
    }

    #departmentModal .modal-header input[type="text"] {
        font-size: 0.9rem;
        padding: 10px 12px;
    }

    #departmentModal .close-btn {
        width: 40px;
        height: 40px;
        font-size: 2rem;
    }

    #departmentModal .modal-body {
        padding: 12px;
    }

    .resource-tabs {
        gap: 8px;
        margin-bottom: 15px;
        padding-bottom: 10px;
    }

    .resource-tab {
        font-size: 0.8rem;
        padding: 8px 12px;
    }

    #departmentModal .resource-item {
        padding: 15px;
    }

    #departmentModal .resource-item h4 {
        font-size: 1rem;
    }

    #departmentModal .resource-item p {
        font-size: 0.85rem;
    }

    #departmentModal .resource-actions {
        gap: 10px;
        margin-top: 15px;
    }

    #departmentModal .resource-btn {
        font-size: 0.85rem;
        padding: 10px 14px;
    }

    #departmentModal .category-badge {
        font-size: 0.75rem;
        padding: 4px 8px;
        margin-right: 6px;
        margin-top: 6px;
    }
}

/* Extra Small Mobile */
@media (max-width: 360px) {
    #departmentModal .modal-header {
        padding: 10px 12px;
    }

    #deptModalTitle {
        font-size: 0.9rem;
    }

    #deptModalTitle i {
        font-size: 1.1rem;
    }

    #departmentModal .close-btn {
        width: 35px;
        height: 35px;
        font-size: 1.6rem;
    }

    #departmentModal .modal-body {
        padding: 10px;
    }

    #departmentModal .resource-item {
        padding: 12px;
    }

    #departmentModal .resource-btn {
        font-size: 0.8rem;
        padding: 8px 12px;
        min-height: 40px;
    }
}

/* Landscape Mode for Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    #departmentModal .modal-header {
        padding: 10px 20px;
        min-height: 50px;
    }

    #departmentModal .modal-body {
        padding: 15px 20px;
    }

    .resource-tabs {
        margin-bottom: 15px;
    }
}

/* iPhone Safe Area Support */
@media (max-width: 428px) {
    #departmentModal {
        padding-bottom: env(safe-area-inset-bottom);
    }

    #departmentModal .modal-header {
        padding-top: max(env(safe-area-inset-top), 15px);
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    #departmentModal .resource-tab {
        min-height: 44px;
        padding: 12px 20px;
    }

    #departmentModal .resource-btn {
        min-height: 44px;
        padding: 12px 18px;
    }

    #departmentModal .close-btn {
        min-width: 44px;
        min-height: 44px;
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    #departmentModal {
        background: var(--dark);
    }

    #departmentModal .resource-item {
        background: rgba(255, 140, 0, 0.08);
        border-color: rgba(255, 140, 0, 0.4);
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    #departmentModal .resource-item {
        border-width: 2px;
        border-color: var(--primary);
    }

    #departmentModal .resource-tab {
        border-width: 2px;
    }

    #departmentModal .close-btn {
        border-width: 3px;
    }
}

/* Print Styles */
@media print {
    #departmentModal .modal-header,
    #departmentModal .close-btn,
    .resource-tabs {
        display: none !important;
    }

    #departmentModal {
        background: white;
    }

    #departmentModal .modal-body {
        padding: 20px;
    }

    #departmentModal .resource-item {
        background: white;
        border: 1px solid #ccc;
        page-break-inside: avoid;
    }
}
/* Resource Type Tabs */
.resource-tabs {
    display: flex;
    gap: clamp(8px, 2vw, 15px);
    margin-bottom: clamp(20px, 4vw, 30px);
    padding-bottom: clamp(10px, 2vw, 15px);
    border-bottom: 2px solid rgba(255, 140, 0, 0.2);
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) rgba(255, 255, 255, 0.1);
    -webkit-overflow-scrolling: touch;
}

.resource-tabs::-webkit-scrollbar {
    height: clamp(4px, 1vw, 6px);
}

.resource-tabs::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.resource-tabs::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

.resource-tab {
    padding: clamp(10px, 2.5vw, 14px) clamp(20px, 4vw, 30px);
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 140, 0, 0.2);
    color: rgba(255, 255, 255, 0.7);
    border-radius: clamp(8px, 2vw, 12px);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    font-size: clamp(0.85rem, 2vw, 1rem);
    font-family: var(--font-body);
    white-space: nowrap;
    position: relative;
    -webkit-tap-highlight-color: transparent;
}

.resource-tab:hover {
    background: rgba(255, 140, 0, 0.1);
    border-color: var(--primary);
    color: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
}

.resource-tab.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-color: var(--primary);
    color: #fff;
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
}

/* Resource Content Tabs */
.resource-content-tab {
    display: none;
}

.resource-content-tab.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

/* Resource Lists */
#pastQuestionsList,
#otherResourcesList {
    display: grid;
    gap: clamp(15px, 3vw, 25px);
}

/* Individual Resource Items - Already styled in main CSS but ensuring full responsiveness */
#departmentModal .resource-item {
    background: rgba(255, 140, 0, 0.05);
    border: 1px solid rgba(255, 140, 0, 0.3);
    padding: clamp(15px, 4vw, 25px);
    border-left: 4px solid var(--primary);
    border-radius: clamp(10px, 2vw, 16px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#departmentModal .resource-item:hover {
    background: rgba(255, 140, 0, 0.1);
    transform: translateX(5px);
    box-shadow: 0 4px 20px rgba(255, 140, 0, 0.2);
}

#departmentModal .resource-item h4 {
    font-size: clamp(1rem, 3vw, 1.3rem);
    color: var(--primary);
    margin-bottom: clamp(8px, 2vw, 12px);
    font-family: var(--font-display);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

#departmentModal .resource-item p {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: clamp(6px, 1.5vw, 10px);
    line-height: 1.6;
    font-size: clamp(0.85rem, 2vw, 1rem);
}

#departmentModal .resource-actions {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    margin-top: clamp(12px, 3vw, 18px);
    flex-wrap: wrap;
}

#departmentModal .resource-btn {
    padding: clamp(8px, 2vw, 12px) clamp(16px, 3vw, 24px);
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: clamp(6px, 1.5vw, 10px);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-family: var(--font-body);
    display: inline-flex;
    align-items: center;
    gap: clamp(6px, 1.5vw, 10px);
    font-size: clamp(0.8rem, 2vw, 0.95rem);
    -webkit-tap-highlight-color: transparent;
    flex: 1 1 auto;
    justify-content: center;
    min-height: 44px;
}

#departmentModal .resource-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
}

#departmentModal .resource-btn:active {
    transform: translateY(0);
}

#departmentModal .resource-btn.secondary {
    background: var(--secondary);
}

#departmentModal .resource-btn.secondary:hover {
    background: #5568d3;
}

#departmentModal .category-badge {
    display: inline-block;
    padding: clamp(4px, 1vw, 6px) clamp(10px, 2vw, 14px);
    background: rgba(255, 140, 0, 0.2);
    color: var(--primary);
    font-size: clamp(0.75rem, 1.8vw, 0.85rem);
    border-radius: clamp(4px, 1vw, 6px);
    margin-right: clamp(6px, 1.5vw, 10px);
    margin-top: clamp(4px, 1vw, 6px);
    font-weight: 600;
}

/* Empty State */
#departmentModal .empty-state {
    text-align: center;
    padding: clamp(40px, 8vw, 80px) clamp(20px, 4vw, 40px);
    color: rgba(255, 255, 255, 0.5);
}

#departmentModal .empty-state i {
    font-size: clamp(3rem, 8vw, 5rem);
    margin-bottom: clamp(15px, 3vw, 25px);
    color: rgba(255, 140, 0, 0.3);
}

/* ==================== RESPONSIVE BREAKPOINTS ==================== */

/* Large Tablets */
@media (max-width: 1024px) {
    #departmentModal .modal-header {
        flex-direction: column;
        align-items: stretch;
    }

    #deptModalTitle {
        text-align: center;
        justify-content: center;
        order: 1;
        flex: 1 1 100%;
    }

    #departmentModal .modal-header input[type="text"] {
        order: 2;
        max-width: 100%;
        flex: 1 1 100%;
    }

    #departmentModal .close-btn {
        order: 3;
        align-self: center;
    }
}

/* Tablets (Portrait) */
@media (max-width: 768px) {
    #departmentModal .modal-header {
        padding: 15px 20px;
    }

    #departmentModal .modal-body {
        padding: 15px;
    }

    .resource-tabs {
        gap: 10px;
        margin-bottom: 20px;
    }

    .resource-tab {
        font-size: 0.85rem;
        padding: 10px 16px;
    }

    #departmentModal .resource-actions {
        flex-direction: column;
    }

    #departmentModal .resource-btn {
        width: 100%;
        flex: 1 1 100%;
    }
}

/* Mobile Phones (Portrait) */
@media (max-width: 480px) {
    #departmentModal .modal-header {
        padding: 12px 15px;
        min-height: 60px;
    }

    #deptModalTitle {
        font-size: 1rem;
        margin-bottom: 10px;
    }

    #departmentModal .modal-header input[type="text"] {
        font-size: 0.9rem;
        padding: 10px 12px;
    }

    #departmentModal .close-btn {
        width: 40px;
        height: 40px;
        font-size: 2rem;
    }

    #departmentModal .modal-body {
        padding: 12px;
    }

    .resource-tabs {
        gap: 8px;
        margin-bottom: 15px;
        padding-bottom: 10px;
    }

    .resource-tab {
        font-size: 0.8rem;
        padding: 8px 12px;
    }

    #departmentModal .resource-item {
        padding: 15px;
    }

    #departmentModal .resource-item h4 {
        font-size: 1rem;
    }

    #departmentModal .resource-item p {
        font-size: 0.85rem;
    }

    #departmentModal .resource-actions {
        gap: 10px;
        margin-top: 15px;
    }

    #departmentModal .resource-btn {
        font-size: 0.85rem;
        padding: 10px 14px;
    }

    #departmentModal .category-badge {
        font-size: 0.75rem;
        padding: 4px 8px;
        margin-right: 6px;
        margin-top: 6px;
    }
}

/* Extra Small Mobile */
@media (max-width: 360px) {
    #departmentModal .modal-header {
        padding: 10px 12px;
    }

    #deptModalTitle {
        font-size: 0.9rem;
    }

    #deptModalTitle i {
        font-size: 1.1rem;
    }

    #departmentModal .close-btn {
        width: 35px;
        height: 35px;
        font-size: 1.6rem;
    }

    #departmentModal .modal-body {
        padding: 10px;
    }

    #departmentModal .resource-item {
        padding: 12px;
    }

    #departmentModal .resource-btn {
        font-size: 0.8rem;
        padding: 8px 12px;
        min-height: 40px;
    }
}

/* Landscape Mode for Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    #departmentModal .modal-header {
        padding: 10px 20px;
        min-height: 50px;
    }

    #departmentModal .modal-body {
        padding: 15px 20px;
    }

    .resource-tabs {
        margin-bottom: 15px;
    }
}

/* iPhone Safe Area Support */
@media (max-width: 428px) {
    #departmentModal {
        padding-bottom: env(safe-area-inset-bottom);
    }

    #departmentModal .modal-header {
        padding-top: max(env(safe-area-inset-top), 15px);
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    #departmentModal .resource-tab {
        min-height: 44px;
        padding: 12px 20px;
    }

    #departmentModal .resource-btn {
        min-height: 44px;
        padding: 12px 18px;
    }

    #departmentModal .close-btn {
        min-width: 44px;
        min-height: 44px;
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    #departmentModal {
        background: var(--dark);
    }

    #departmentModal .resource-item {
        background: rgba(255, 140, 0, 0.08);
        border-color: rgba(255, 140, 0, 0.4);
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    #departmentModal .resource-item {
        border-width: 2px;
        border-color: var(--primary);
    }

    #departmentModal .resource-tab {
        border-width: 2px;
    }

    #departmentModal .close-btn {
        border-width: 3px;
    }
}

/* Print Styles */
@media print {
    #departmentModal .modal-header,
    #departmentModal .close-btn,
    .resource-tabs {
        display: none !important;
    }

    #departmentModal {
        background: white;
    }

    #departmentModal .modal-body {
        padding: 20px;
    }

    #departmentModal .resource-item {
        background: white;
        border: 1px solid #ccc;
        page-break-inside: avoid;
    }
}

/* ==================== FIXED DEPARTMENT RESOURCES - NO OVERLAPPING ==================== */

/* Container for Resource Lists - Prevent Overlapping */
#pastQuestionsList,
#otherResourcesList {
    display: flex;
    flex-direction: column;
    gap: clamp(15px, 3vw, 25px);
    width: 100%;
    max-width: 100%;
    padding: 0;
    margin: 0;
    box-sizing: border-box;
}

/* Individual Resource Item - Fully Responsive, No Overlap */
#departmentModal .resource-item,
#pastQuestionsList .resource-item,
#otherResourcesList .resource-item,
.resource-item {
    background: rgba(255, 140, 0, 0.05) !important;
    border: 1px solid rgba(255, 140, 0, 0.3) !important;
    padding: clamp(12px, 3vw, 20px) !important;
    border-left: 4px solid var(--primary) !important;
    border-radius: clamp(8px, 2vw, 12px) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    position: relative !important;
    margin: 0 0 clamp(12px, 3vw, 20px) 0 !important;
    display: block !important;
}

.resource-item:last-child {
    margin-bottom: 0 !important;
}

.resource-item:hover {
    background: rgba(255, 140, 0, 0.12) !important;
    transform: translateY(-3px) !important;
    box-shadow: 0 6px 25px rgba(255, 140, 0, 0.25) !important;
}

/* Resource Item Title - No Overflow */
.resource-item h4 {
    font-size: clamp(0.95rem, 3vw, 1.2rem) !important;
    color: var(--primary) !important;
    margin: 0 0 clamp(8px, 2vw, 12px) 0 !important;
    font-family: var(--font-display) !important;
    font-weight: 700 !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    hyphens: auto !important;
    line-height: 1.4 !important;
    width: 100% !important;
    max-width: 100% !important;
    display: block !important;
}

.resource-item h4 i {
    margin-right: clamp(6px, 1.5vw, 8px) !important;
    font-size: clamp(0.9rem, 2.5vw, 1.1rem) !important;
}

/* Resource Item Paragraphs - Prevent Overflow */
.resource-item p {
    color: rgba(255, 255, 255, 0.75) !important;
    margin: 0 0 clamp(6px, 1.5vw, 10px) 0 !important;
    line-height: 1.6 !important;
    font-size: clamp(0.8rem, 2vw, 0.95rem) !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    width: 100% !important;
    max-width: 100% !important;
    display: block !important;
}

.resource-item p strong {
    color: rgba(255, 255, 255, 0.95) !important;
    font-weight: 600 !important;
}

/* Badge Container - Flexible Wrapping */
.resource-item > div:not(.resource-actions) {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: clamp(6px, 1.5vw, 10px) !important;
    margin: clamp(10px, 2vw, 12px) 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Category Badges - Responsive */
.category-badge {
    display: inline-flex !important;
    align-items: center !important;
    gap: clamp(4px, 1vw, 6px) !important;
    padding: clamp(4px, 1.2vw, 6px) clamp(8px, 2vw, 12px) !important;
    background: rgba(255, 140, 0, 0.2) !important;
    color: var(--primary) !important;
    font-size: clamp(0.7rem, 1.8vw, 0.82rem) !important;
    border-radius: clamp(4px, 1vw, 6px) !important;
    font-weight: 600 !important;
    white-space: nowrap !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-sizing: border-box !important;
}

.category-badge i {
    font-size: clamp(0.65rem, 1.5vw, 0.75rem) !important;
    flex-shrink: 0 !important;
}

/* Resource Actions Container - Fully Responsive */
.resource-actions {
    display: flex !important;
    flex-direction: row !important;
    gap: clamp(8px, 2vw, 12px) !important;
    margin-top: clamp(12px, 3vw, 18px) !important;
    width: 100% !important;
    max-width: 100% !important;
    flex-wrap: wrap !important;
    box-sizing: border-box !important;
}

/* Resource Buttons - Responsive & Touch-Friendly */
.resource-btn {
    flex: 1 1 calc(33.333% - 10px) !important;
    min-width: clamp(90px, 22vw, 130px) !important;
    padding: clamp(10px, 2.5vw, 13px) clamp(12px, 3vw, 18px) !important;
    background: var(--primary) !important;
    color: #fff !important;
    border: none !important;
    border-radius: clamp(6px, 1.5vw, 8px) !important;
    cursor: pointer !important;
    font-weight: 600 !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    font-family: var(--font-body) !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: clamp(5px, 1.5vw, 8px) !important;
    font-size: clamp(0.75rem, 2vw, 0.9rem) !important;
    -webkit-tap-highlight-color: transparent !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    min-height: clamp(42px, 9vw, 48px) !important;
    box-sizing: border-box !important;
}

.resource-btn i {
    font-size: clamp(0.75rem, 2vw, 0.95rem) !important;
    flex-shrink: 0 !important;
}

.resource-btn:hover {
    background: var(--primary-dark) !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 5px 18px rgba(255, 140, 0, 0.35) !important;
}

.resource-btn:active {
    transform: translateY(0) !important;
}

.resource-btn.secondary {
    background: var(--secondary) !important;
}

.resource-btn.secondary:hover {
    background: #5568d3 !important;
    box-shadow: 0 5px 18px rgba(102, 126, 234, 0.35) !important;
}

/* ==================== RESPONSIVE BREAKPOINTS FOR RESOURCES ==================== */

/* Large Desktop - Single Column, Centered */
@media (min-width: 1400px) {
    #pastQuestionsList,
    #otherResourcesList {
        max-width: 1200px !important;
        margin: 0 auto !important;
    }
}

/* Desktop - Two Column Grid */
@media (min-width: 1025px) and (max-width: 1399px) {
    #pastQuestionsList,
    #otherResourcesList {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: clamp(18px, 3vw, 25px) !important;
    }
    
    .resource-item {
        margin: 0 !important;
    }
}

/* Large Tablets - Single Column */
@media (min-width: 769px) and (max-width: 1024px) {
    #pastQuestionsList,
    #otherResourcesList {
        padding: 0 clamp(10px, 2vw, 15px) !important;
    }

    .resource-item {
        padding: clamp(15px, 3vw, 18px) !important;
    }

    .resource-actions {
        gap: 10px !important;
    }

    .resource-btn {
        flex: 1 1 calc(33.333% - 8px) !important;
        min-width: 100px !important;
        font-size: 0.85rem !important;
        padding: 11px 14px !important;
    }
}

/* Tablets (Portrait) */
@media (max-width: 768px) {
    #pastQuestionsList,
    #otherResourcesList {
        padding: 0 !important;
        gap: 18px !important;
    }

    .resource-item {
        padding: 15px !important;
        margin-bottom: 15px !important;
    }

    .resource-item h4 {
        font-size: 1.05rem !important;
        margin-bottom: 10px !important;
    }

    .resource-item p {
        font-size: 0.88rem !important;
        margin-bottom: 8px !important;
    }

    .resource-actions {
        flex-direction: row !important;
        gap: 10px !important;
    }

    .resource-btn {
        flex: 1 1 calc(50% - 5px) !important;
        min-width: 0 !important;
        font-size: 0.82rem !important;
        padding: 11px 12px !important;
    }

    .category-badge {
        font-size: 0.75rem !important;
        padding: 5px 10px !important;
    }
}

/* Mobile Phones (Portrait) */
@media (max-width: 480px) {
    #pastQuestionsList,
    #otherResourcesList {
        gap: 15px !important;
    }

    .resource-item {
        padding: 12px !important;
        margin-bottom: 12px !important;
        border-left-width: 3px !important;
    }

    .resource-item h4 {
        font-size: 0.95rem !important;
        margin-bottom: 8px !important;
        line-height: 1.3 !important;
    }

    .resource-item h4 i {
        font-size: 0.9rem !important;
        margin-right: 6px !important;
    }

    .resource-item p {
        font-size: 0.82rem !important;
        margin-bottom: 6px !important;
        line-height: 1.5 !important;
    }

    .resource-item > div:not(.resource-actions) {
        gap: 6px !important;
        margin: 8px 0 !important;
    }

    .category-badge {
        font-size: 0.7rem !important;
        padding: 4px 8px !important;
        gap: 4px !important;
    }

    .resource-actions {
        flex-direction: column !important;
        gap: 10px !important;
        margin-top: 12px !important;
    }

    .resource-btn {
        flex: 1 1 100% !important;
        width: 100% !important;
        min-width: 100% !important;
        font-size: 0.85rem !important;
        padding: 12px 14px !important;
        min-height: 44px !important;
    }

    .resource-btn i {
        font-size: 0.85rem !important;
    }
}

/* Extra Small Mobile */
@media (max-width: 360px) {
    .resource-item {
        padding: 10px !important;
    }

    .resource-item h4 {
        font-size: 0.9rem !important;
    }

    .resource-item p {
        font-size: 0.78rem !important;
    }

    .category-badge {
        font-size: 0.68rem !important;
        padding: 3px 7px !important;
    }

    .resource-btn {
        font-size: 0.8rem !important;
        padding: 11px 12px !important;
        min-height: 42px !important;
    }
}

/* Landscape Mode for Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .resource-item {
        padding: 12px 15px !important;
    }

    .resource-actions {
        flex-direction: row !important;
    }

    .resource-btn {
        flex: 1 1 calc(33.333% - 8px) !important;
        width: auto !important;
        min-width: 100px !important;
    }
}

/* iPhone Safe Area */
@media (max-width: 428px) {
    #pastQuestionsList,
    #otherResourcesList {
        padding-bottom: max(env(safe-area-inset-bottom), 15px) !important;
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .resource-btn {
        min-height: 44px !important;
        min-width: 44px !important;
        padding: 12px 16px !important;
    }

    .resource-item {
        padding: 15px !important;
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    .resource-item {
        border-width: 2px !important;
        border-color: var(--primary) !important;
    }

    .resource-btn {
        border: 2px solid rgba(255, 255, 255, 0.3) !important;
    }
}
    </style>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>

<body>
    <!-- Animated Background -->
    <div class="animated-bg"></div>

    <!-- AUTH SECTION -->
    <div class="split-container" id="authSection">
        <div class="left-section">
            <div class="branding">
                <h1>FLASH100</h1>
                <p>FASA LASU Academic Support Hub</p>
                <p>Your gateway to academic excellence</p>
                <p class="tagline">Empowering 100 Level students with resources, AI-powered learning, community support,
                    and collaborative tools for success</p>
            </div>
        </div>

        <div class="right-section">
            <div class="form-wrapper">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('login')">Login</button>
                    <button class="tab" onclick="switchTab('signup')">Sign Up</button>
                </div>

                <div id="message" class="message"></div>

                <div id="loginForm" class="form-content active">
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginMatric">Matric Number / Email</label>
                            <input type="text" id="loginMatric" placeholder="2024/1234567 or email" required>
                        </div>

                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        </div>

                        <button type="submit" class="btn">Login</button>
                    </form>
                </div>

                <div id="signupForm" class="form-content">
                    <form onsubmit="handleSignup(event)">
                        <div class="form-group">
                            <label for="signupMatric">Matric Number</label>
                            <input type="text" id="signupMatric" placeholder="2024/1234567" required>
                        </div>

                        <div class="form-group">
                            <label for="signupName">Full Name</label>
                            <input type="text" id="signupName" placeholder="Enter your full name" required>
                        </div>

                        <div class="form-group">
                            <label for="signupEmail">Email Address</label>
                            <input type="email" id="signupEmail" placeholder="yourname@example.com" required>
                        </div>

                        <div class="form-group">
                            <label for="signupDepartment">Department</label>
                            <select id="signupDepartment" required
                                style="width: 100%; padding: 16px 18px; background: rgba(255, 255, 255, 0.06); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; font-size: 1rem; outline: none; border-radius: var(--radius-md); font-family: var(--font-body);">
                                <option value="">Select Department</option>
                                <option value="history">History</option>
                                <option value="iss">International Studies</option>
                                <option value="french">French</option>
                                <option value="portuguese">Portuguese</option>
                                <option value="linguistics">Linguistics</option>
                                <option value="philosophy">Philosophy</option>
                                <option value="theatre-art">Theatre Art</option>
                                <option value="gns">General Studies</option>
                                <option value="english">English</option>
                                <option value="peace-studies">Peace & Religious Studies</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" placeholder="Create a password" required>
                        </div>

                        <button type="submit" class="btn">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- File Viewer Modal -->
    <div class="file-viewer-modal" id="fileViewerModal">
        <div class="file-viewer-header">
            <h3 class="file-viewer-title" id="fileViewerTitle">Document Viewer</h3>
            <div class="file-viewer-controls">
                <div class="font-control">
                    <label>Font:</label>
                    <select id="fontFamily" onchange="updateFileView()">
                        <option value="Georgia, serif">Georgia</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Times New Roman', serif">Times</option>
                        <option value="'Courier New', monospace">Courier</option>
                    </select>
                </div>
                <div class="font-control">
                    <label>Size:</label>
                    <input type="number" id="fontSize" value="16" min="12" max="32" onchange="updateFileView()">
                </div>
                <button class="close-btn" onclick="closeFileViewer()">&times;</button>
            </div>
        </div>
        <div class="file-viewer-body">
            <div id="fileContentDisplay" class="file-content"></div>
        </div>
    </div>
    <!-- STUDENT DASHBOARD -->
    <div class="dashboard" id="studentDashboard">
        <div class="dashboard-header">
            <h2><i class="fas fa-graduation-cap"></i> FLASH100 Dashboard</h2>
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div class="dashboard-content">
            <h3 class="mb-2"
                style="color: var(--primary); font-family: var(--font-display); font-size: clamp(1.5rem, 4vw, 2.5rem);">
                Welcome, <span id="studentName"></span>! 
            </h3>
            <p class="mb-4" style="color: rgba(255, 255, 255, 0.6); font-size: 1.1rem;">
                <span id="studentMatric"></span> | <span id="studentDepartment"></span>
            </p>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchNavTab('overview')">
                    <i class="fas fa-home"></i> Overview
                </button>
                <button class="nav-tab" onclick="switchNavTab('resources')">
                    <i class="fas fa-book"></i> Resources
                </button>
                
            </div>

            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-bell"></i> Announcements</h3>
                    </div>
                    <div id="announcementsList"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-envelope"></i> Personal Messages</h3>
                    </div>
                    <div id="messagesList"></div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div id="resources-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-book"></i> Available Courses & Resources</h3>
                    </div>

                    <!-- Department Filter Tabs -->
                    <div class="dept-filter-tabs"
                        style="display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; border-bottom: 2px solid rgba(255, 140, 0, 0.2); padding-bottom: 15px; overflow-x: auto;">
                        <button class="dept-tab active" onclick="filterByDepartment('')"
                            style="padding: 10px 20px; background: var(--primary); border: none; color: var(--dark); cursor: pointer; font-weight: 600; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">All</button>
                        <button class="dept-tab" onclick="filterByDepartment('history')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">HIS</button>
                        <button class="dept-tab" onclick="filterByDepartment('iss')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">ISS</button>
                        <button class="dept-tab" onclick="filterByDepartment('french')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">French</button>
                        <button class="dept-tab" onclick="filterByDepartment('portuguese')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">Portuguese</button>
                        <button class="dept-tab" onclick="filterByDepartment('linguistics')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">Linguistics</button>
                        <button class="dept-tab" onclick="filterByDepartment('philosophy')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">Philosophy</button>
                        <button class="dept-tab" onclick="filterByDepartment('theatre-art')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">Theatre
                            Art</button>
                        <button class="dept-tab" onclick="filterByDepartment('gns')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">GNS</button>
                        <button class="dept-tab" onclick="filterByDepartment('english')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">English</button>
                        <button class="dept-tab" onclick="filterByDepartment('peace-studies')"
                            style="padding: 10px 20px; background: rgba(255, 140, 0, 0.2); border: 1px solid rgba(255, 140, 0, 0.5); color: #fff; cursor: pointer; border-radius: 4px; white-space: nowrap; font-family: var(--font-body); transition: all 0.3s;">Peace
                            & Religious Studies</button>
                    </div>
                </div>
            </div>

            <!-- AI Learn Tab -->
            <div id="ai-learn-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-robot"></i> AI Learning Assistant</h3>
                        <button class="action-btn" onclick="clearAIChat()">
                            <i class="fas fa-trash"></i> Clear Chat
                        </button>
                    </div>
                    <div class="ai-chat-container">
                        <div class="ai-chat-messages" id="aiChatMessages"></div>
                        <div class="ai-chat-input-container">
                            <input type="text" class="ai-chat-input" id="aiChatInput"
                                placeholder="Ask anything... (e.g., 'Explain quantum physics')"
                                onkeypress="handleAIChatKeyPress(event)">
                            <button class="ai-send-btn" onclick="sendAIMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <p class="mt-3" style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; text-align: center;">
                        <i class="fas fa-info-circle"></i> Powered by free AI API - Your conversations are saved for
                        reference
                    </p>
                </div>
            </div>

            <!-- Study Timer Tab -->
            <div id="study-timer-tab" class="tab-content">
                <div class="timer-container">
                    <h3 style="font-family: var(--font-display); font-size: 2rem; margin-bottom: var(--space-md);">
                        <i class="fas fa-stopwatch"></i> Pomodoro Study Timer
                    </h3>
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer()">
                            <i class="fas fa-play"></i> Start
                        </button>
                        <button class="timer-btn" onclick="pauseTimer()">
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="timer-btn danger" onclick="resetTimer()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    <p class="mt-3" style="color: rgba(255, 255, 255, 0.6);">
                        Focus: 25 min | Break: 5 min | Sessions completed: <span id="sessionsCompleted">0</span>
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Study Statistics</h3>
                    </div>
                    <div id="studyStats"></div>
                </div>
            </div>

            <!-- Community Tab -->
            <div id="community-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-comments"></i> Department Communities</h3>
                    </div>
                    <div class="community-grid" id="communityGrid"></div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-plus-circle"></i> Create Post</h3>
                    </div>
                    <textarea id="newPostContent" placeholder="Share your thoughts, questions, or resources..."
                        style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); min-height: 120px; font-family: var(--font-body); margin-bottom: var(--space-md);"></textarea>
                    <button class="btn" onclick="createPost()" style="width: auto; padding: 12px 32px;">
                        <i class="fas fa-paper-plane"></i> Post
                    </button>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-stream"></i> Community Feed</h3>
                    </div>
                    <div id="communityFeed"></div>
                </div>
            </div>

            <!-- Course Outlines Tab -->
            <div id="outlines-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-book-open"></i> Course Outlines - <span
                                id="outlineDeptName"></span></h3>
                    </div>
                    <div id="outlinesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Department Resources Modal -->
    <div class="modal" id="departmentModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h3 id="deptModalTitle"><i class="fas fa-folder-open"></i> Department Resources</h3>
                <button class="close-btn" onclick="closeDepartmentModal()">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Search Bar -->
                <div style="margin-bottom: 30px;">
                    <input type="text" id="deptSearchInput" placeholder="Search resources by title or description..."
                        onkeyup="searchDepartmentResources()"
                        style="width: 100%; padding: 15px 20px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.3); color: #fff; border-radius: var(--radius-md); font-size: 1rem; font-family: var(--font-body);">
                </div>

                <!-- Resource Tabs -->
                <div class="resource-tabs"
                    style="display: flex; gap: 0; margin-bottom: 40px; border-bottom: 3px solid rgba(255, 140, 0, 0.2);">
                    <button class="resource-tab active" onclick="switchResourceType('past-questions')"
                        style="flex: 1; padding: 20px 40px; background: none; border: none; color: rgba(255, 255, 255, 0.5); font-size: 1.2rem; font-weight: 600; cursor: pointer; position: relative; transition: all 0.3s; text-align: center; font-family: var(--font-body);">
                        <i class="fas fa-file-alt"></i> Past Questions
                    </button>
                    <button class="resource-tab" onclick="switchResourceType('other')"
                        style="flex: 1; padding: 20px 40px; background: none; border: none; color: rgba(255, 255, 255, 0.5); font-size: 1.2rem; font-weight: 600; cursor: pointer; position: relative; transition: all 0.3s; text-align: center; font-family: var(--font-body);">
                        <i class="fas fa-book"></i> Departmental Resources
                    </button>
                </div>

                <!-- Past Questions Tab -->
                <div id="pastQuestionsTab" class="form-content active">
                    <div id="pastQuestionsList" style="display: grid; gap: 20px;"></div>
                </div>

                <!-- Other Resources Tab -->
                <div id="otherResourcesTab" class="form-content">
                    <div id="otherResourcesList" style="display: grid; gap: 20px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div class="dashboard" id="adminDashboard">
        <div class="dashboard-header">
            <h2><i class="fas fa-user-shield"></i> Admin Dashboard</h2>
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div class="dashboard-content">
            <h3 class="mb-4" style="color: var(--primary); font-family: var(--font-display); font-size: 2rem;">
                Welcome, Admin! 
            </h3>

            <!-- Admin Navigation -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchAdminTab('overview')">
                    <i class="fas fa-tachometer-alt"></i> Overview
                </button>
                <button class="nav-tab" onclick="switchAdminTab('upload')">
                    <i class="fas fa-upload"></i> Upload Resources
                </button>
                
                <button class="nav-tab" onclick="switchAdminTab('users')">
                    <i class="fas fa-users"></i> Users
                </button>
                <button class="nav-tab" onclick="switchAdminTab('feedback')">
                    <i class="fas fa-comments"></i> Feedback
                </button>
            </div>

            <!-- Admin Overview -->
            <div id="admin-overview-tab" class="tab-content active">
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                    <div class="card" style="text-align: center;">
                        <h3 style="color: var(--primary); font-size: 3rem;" id="totalUsers">0</h3>
                        <p style="color: rgba(255, 255, 255, 0.7);">Total Users</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3 style="color: var(--accent); font-size: 3rem;" id="totalResources">0</h3>
                        <p style="color: rgba(255, 255, 255, 0.7);">Resources</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3 style="color: var(--secondary); font-size: 3rem;" id="totalPosts">0</h3>
                        <p style="color: rgba(255, 255, 255, 0.7);">Community Posts</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-bullhorn"></i> Send Announcement</h3>
                    </div>
                    <input type="text" id="announcementTitle" placeholder="Announcement Title"
                        style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); margin-bottom: var(--space-md); font-family: var(--font-body);">
                    <textarea id="announcementContent" placeholder="Announcement content..."
                        style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); min-height: 120px; font-family: var(--font-body); margin-bottom: var(--space-md);"></textarea>
                    <button class="btn" onclick="sendAnnouncement()" style="width: auto; padding: 12px 32px;">
                        <i class="fas fa-paper-plane"></i> Send to All Students
                    </button>
                </div>
            </div>

            <!-- Admin Upload Tab -->
            <div id="admin-upload-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-cloud-upload-alt"></i> Upload Resources</h3>
                    </div>

                    <div class="form-group">
                        <label>Department</label>
                        <select id="uploadDepartment"
                            style="width: 100%; padding: 16px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); font-family: var(--font-body);">
                            <option value="">Select Department</option>
                            <option value="history">History</option>
                            <option value="iss">International Studies</option>
                            <option value="french">French</option>
                            <option value="portuguese">Portuguese</option>
                            <option value="linguistics">Linguistics</option>
                            <option value="philosophy">Philosophy</option>
                            <option value="theatre-art">Theatre Art</option>
                            <option value="gns">General Studies</option>
                            <option value="english">English</option>
                            <option value="peace-studies">Peace & Religious Studies</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Resource Title</label>
                        <input type="text" id="uploadTitle" placeholder="e.g., Introduction to History">
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="uploadDescription" placeholder="Describe the resource..."
                            style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); min-height: 100px; font-family: var(--font-body);"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Category</label>
                        <select id="uploadCategory"
                            style="width: 100%; padding: 16px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); font-family: var(--font-body);">
                            <option value="past-questions">Past Questions</option>
                            <option value="lecture-notes">Lecture Notes</option>
                            <option value="textbooks">Textbooks</option>
                            <option value="assignments">Assignments</option>
                            <option value="tutorials">Tutorials</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>File</label>
                        <input type="file" id="uploadFile"
                            style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); font-family: var(--font-body);">
                    </div>

                    <button class="btn" onclick="uploadResource()">
                         <i class="fas fa-upload"></i> Upload Resource
                     </button>
                    </div>

                    <div class="card mt-4">
                     <div class="card-header">
                         <h3 class="card-title"><i class="fas fa-list"></i> Uploaded Resources</h3>
                     </div>
                     <div id="uploadedResourcesList"></div>
                    </div>
                    </div>

            <!-- Admin Course Outlines Tab -->
            <div id="admin-outlines-admin-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-edit"></i> Add Course Outline</h3>
                    </div>

                    <div class="form-group">
                        <label>Department</label>
                        <select id="adminoutlineDepartment"
                            style="width: 100%; padding: 16px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); font-family: var(--font-body);">
                            <option value="">Select Department</option>
                            <option value="history">History</option>
                            <option value="iss">International Studies</option>
                            <option value="french">French</option>
                            <option value="portuguese">Portuguese</option>
                            <option value="linguistics">Linguistics</option>
                            <option value="philosophy">Philosophy</option>
                            <option value="theatre-art">Theatre Art</option>
                            <option value="gns">General Studies</option>
                            <option value="english">English</option>
                            <option value="peace-studies">Peace & Religious Studies</option>
                        </select>
                    </div>

                    <div class="form-group">
                         <label>Course Name</label>
                         <input type="text" id="adminoutlineCourseName" placeholder="e.g., HIS 101 - Introduction to History" style="width: 100%; padding: 16px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); font-family: var(--font-body);">
                     </div>

                     <div class="form-group">
                         <label>Course Outline (Auto-detects weeks)</label>
                         <textarea id="adminoutlineContent" placeholder="Format:&#10;Week 1: Introduction to the course&#10;Week 2: Historical methods and sources&#10;Week 3: Ancient civilizations&#10;..." style="width: 100%; padding: var(--space-md); background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.2); color: #fff; border-radius: var(--radius-md); min-height: 200px; font-family: var(--font-body);"></textarea>
                         <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; margin-top: 10px;">
                             <i class="fas fa-info-circle"></i> Start each week with "Week X:" - the system will automatically parse and save each week separately
                         </p>
                     </div>

                    <button class="btn" onclick="addCourseOutline()">
                        <i class="fas fa-plus"></i> Add Outline
                    </button>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-list"></i> Existing Outlines</h3>
                    </div>
                    <div id="existingOutlines"></div>
                </div>
            </div>

            <!-- Admin Users Tab -->
            <div id="admin-users-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-user-friends"></i> Registered Users</h3>
                    </div>
                    <div id="usersList"></div>
                </div>
            </div>

            <!-- Admin Feedback Tab -->
            <div id="admin-feedback-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-comment-dots"></i> Student Feedback</h3>
                    </div>
                    <div id="feedbackList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
      
// ==================== FIREBASE CONFIGURATION ====================
const firebaseConfig = {
    apiKey: "AIzaSyDRedGhjpZA8cjd-aa-F4GEcwx9Y5Z3fjw",
    authDomain: "uniuse.firebaseapp.com",
    projectId: "uniuse",
    storageBucket: "uniuse.firebasestorage.app",
    messagingSenderId: "132594569463",
    appId: "1:132594569463:web:b5e03aa73910f371c7c3f2",
    measurementId: "G-9QTP9ZXN1M"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const ADMIN_EMAIL = 'toluwanioloyede27@gmail.com';
const ADMIN_PASSWORD = '1234ABCD';
const CLOUDINARY_CLOUD_NAME = 'dzhdgxjhl';
const CLOUDINARY_UPLOAD_PRESET = 'posepreset';

// Current User Data
let currentUser = null;

// ==================== FORCE HTTPS FOR ALL URLS ====================
function ensureHttps(url) {
    if (!url) return '';
    // Convert http:// to https://
    if (url.startsWith('http://')) {
        return url.replace('http://', 'https://');
    }
    return url;
}

// ==================== AUTH FUNCTIONS ====================
function switchTab(tab) {
    const tabs = document.querySelectorAll('.tab');
    const forms = document.querySelectorAll('.form-content');

    tabs.forEach(t => t.classList.remove('active'));
    forms.forEach(f => f.classList.remove('active'));

    if (tab === 'login') {
        tabs[0].classList.add('active');
        document.getElementById('loginForm').classList.add('active');
    } else {
        tabs[1].classList.add('active');
        document.getElementById('signupForm').classList.add('active');
    }

    hideMessage();
}

function showMessage(text, type = 'success') {
    const msg = document.getElementById('message');
    msg.textContent = text;
    msg.className = 'message show ' + type;
    setTimeout(() => hideMessage(), 4000);
}

function hideMessage() {
    const msg = document.getElementById('message');
    msg.classList.remove('show');
}

function handleSignup(e) {
    e.preventDefault();

    const matric = document.getElementById('signupMatric').value;
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const department = document.getElementById('signupDepartment').value;
    const password = document.getElementById('signupPassword').value;

    if (!matric || !name || !email || !department || !password) {
        showMessage('Please fill in all fields', 'error');
        return;
    }

    // Check if matric already exists
    db.collection('students').where('matric', '==', matric).get().then(snapshot => {
        if (!snapshot.empty) {
            showMessage('This matric number is already registered!', 'error');
            return;
        }

        // Create user with Firebase Auth
        auth.createUserWithEmailAndPassword(email, password).then(userCredential => {
            const firebaseUser = userCredential.user;

            // Save additional user data to Firestore
            db.collection('students').doc(firebaseUser.uid).set({
                uid: firebaseUser.uid,
                matric: matric,
                name: name,
                email: email,
                department: department,
                registeredDate: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                showMessage('Account created successfully! You can now login.', 'success');

                setTimeout(() => {
                    switchTab('login');
                    document.getElementById('loginMatric').value = matric;
                    e.target.reset();
                    auth.signOut();
                }, 1500);
            }).catch(error => {
                console.error('Firestore error:', error);
                showMessage('Error saving user data: ' + error.message, 'error');
            });
        }).catch(error => {
            console.error('Auth error:', error);
            if (error.code === 'auth/email-already-in-use') {
                showMessage('This email is already registered!', 'error');
            } else if (error.code === 'auth/weak-password') {
                showMessage('Password should be at least 6 characters!', 'error');
            } else {
                showMessage('Signup error: ' + error.message, 'error');
            }
        });
    }).catch(error => {
        console.error('Error checking matric:', error);
        showMessage('Error during signup: ' + error.message, 'error');
    });
}

function handleLogin(e) {
    e.preventDefault();

    const identifier = document.getElementById('loginMatric').value;
    const password = document.getElementById('loginPassword').value;

    if (!identifier || !password) {
        showMessage('Please fill in all fields', 'error');
        return;
    }

    // Check for admin login
    if (identifier === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
        showMessage('Admin login successful!', 'success');
        setTimeout(() => {
            showAdminDashboard();
            e.target.reset();
        }, 1000);
        return;
    }

    // Student login
    db.collection('students').where('matric', '==', identifier).get().then(snapshot => {
        if (snapshot.empty) {
            showMessage('Matric number not found. Please sign up first.', 'error');
            return;
        }

        const studentDoc = snapshot.docs[0];
        const studentData = studentDoc.data();
        const email = studentData.email;

        auth.signInWithEmailAndPassword(email, password).then(userCredential => {
            showMessage(`Welcome back, ${studentData.name}!`, 'success');

            setTimeout(() => {
                showStudentDashboard(studentData);
                e.target.reset();
            }, 1500);
        }).catch(error => {
            console.error('Firebase Auth error:', error);
            if (error.code === 'auth/wrong-password') {
                showMessage('Incorrect password. Please try again.', 'error');
            } else {
                showMessage('Login error: ' + error.message, 'error');
            }
        });
    }).catch(error => {
        console.error('Firestore error:', error);
        showMessage('Error during login: ' + error.message, 'error');
    });
}

// Auto-login with Firebase Authentication
auth.onAuthStateChanged(function (user) {
    if (user) {
        db.collection('students').doc(user.uid).get().then(doc => {
            if (doc.exists) {
                const studentData = doc.data();
                showStudentDashboard(studentData);
            }
        }).catch(error => {
            console.error('Auto-login error:', error);
        });
    }
});

function logout() {
    auth.signOut().then(() => {
        document.getElementById('authSection').style.display = 'flex';
        document.getElementById('studentDashboard').classList.remove('active');
        document.getElementById('adminDashboard').classList.remove('active');
        currentUser = null;
    });
}

// ==================== DASHBOARD FUNCTIONS ====================
function showStudentDashboard(userData) {
    currentUser = userData;

    document.getElementById('authSection').style.display = 'none';
    document.getElementById('studentDashboard').classList.add('active');
    document.getElementById('studentName').textContent = userData.name;
    document.getElementById('studentMatric').textContent = userData.matric;
    document.getElementById('studentDepartment').textContent = getDepartmentFullName(userData.department);
    document.getElementById('outlineDeptName').textContent = getDepartmentFullName(userData.department);

    // Load data
    loadAnnouncements();
    loadPersonalMessages();
    loadCommunities();
    loadCommunityFeed();
    loadCourseOutlines();
    loadAIConversations();
    loadStudyStats();
}

function showAdminDashboard() {
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('adminDashboard').classList.add('active');

    loadAdminStats();
    loadUsers();
    loadFeedback();
    loadExistingOutlines();
}

function getDepartmentFullName(dept) {
    const deptMap = {
        'history': 'History',
        'iss': 'International Studies',
        'french': 'French',
        'portuguese': 'Portuguese',
        'linguistics': 'Linguistics',
        'philosophy': 'Philosophy',
        'theatre-art': 'Theatre Art',
        'gns': 'General Studies',
        'english': 'English',
        'peace-studies': 'Peace & Religious Studies'
    };
    return deptMap[dept] || dept;
}

// ==================== NAVIGATION ====================
function switchNavTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active from all nav tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab
    document.getElementById(tabName + '-tab').classList.add('active');

    // Add active to clicked nav tab
    event.target.classList.add('active');
}

function switchAdminTab(tabName) {
    // Hide all admin tabs
    document.querySelectorAll('#adminDashboard .tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active from all nav tabs
    document.querySelectorAll('#adminDashboard .nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab
    document.getElementById('admin-' + tabName + '-tab').classList.add('active');

    // Add active to clicked nav tab
    event.target.classList.add('active');

    // Initialize admin features when those tabs are opened
    if (tabName === 'upload') {
        loadUploadedResources();
    } else if (tabName === 'outlines-admin') {
        loadExistingOutlines();
    }
}

// ==================== ANNOUNCEMENTS ====================
function loadAnnouncements() {
    const list = document.getElementById('announcementsList');
    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('announcements').orderBy('sentDate', 'desc').limit(5).get().then(snapshot => {
        if (snapshot.empty) {
            list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No announcements yet</p>';
        } else {
            list.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                    <h4 style="color: var(--primary); margin-bottom: 10px;">${data.title}</h4>
                    <p style="color: rgba(255, 255, 255, 0.8); line-height: 1.6;">${data.content}</p>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5); margin-top: 10px;">
                        ${data.sentDate ? new Date(data.sentDate.toDate()).toLocaleString() : 'Just now'}
                    </p>
                `;
                list.appendChild(div);
            });
        }
    });
}

function sendAnnouncement() {
    const title = document.getElementById('announcementTitle').value;
    const content = document.getElementById('announcementContent').value;

    if (!title || !content) {
        alert('Please fill in both title and content');
        return;
    }

    db.collection('announcements').add({
        title: title,
        content: content,
        sentDate: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        alert(' Announcement sent to all students!');
        document.getElementById('announcementTitle').value = '';
        document.getElementById('announcementContent').value = '';
    }).catch(error => {
        alert('Error: ' + error.message);
    });
}

// ==================== MESSAGES ====================
function loadPersonalMessages() {
    const list = document.getElementById('messagesList');
    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('messages').where('recipientMatric', '==', currentUser.matric)
        .orderBy('sentDate', 'desc').limit(5).get().then(snapshot => {
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No messages yet</p>';
            } else {
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'post';
                    div.innerHTML = `
                    <p style="color: rgba(255, 255, 255, 0.8); line-height: 1.6;">${data.message}</p>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5); margin-top: 10px;">
                        From Admin - ${data.sentDate ? new Date(data.sentDate.toDate()).toLocaleString() : 'Just now'}
                    </p>
                `;
                    list.appendChild(div);
                });
            }
        });
}

// ==================== RESOURCES - FIXED FOR FULL PAGE MODAL ====================
let currentDepartmentFilter = '';

function filterByDepartment(department) {
    // Update active tab styling
    document.querySelectorAll('.dept-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.style.background = 'rgba(255, 140, 0, 0.2)';
        tab.style.color = '#fff';
        tab.style.border = '1px solid rgba(255, 140, 0, 0.5)';
    });

    event.target.classList.add('active');
    event.target.style.background = 'var(--primary)';
    event.target.style.color = 'var(--dark)';
    event.target.style.border = 'none';

    currentDepartmentFilter = department;

    // Get department name for modal title
    const deptName = getDepartmentFullName(department) || 'All Departments';
    document.getElementById('deptModalTitle').innerHTML = `<i class="fas fa-folder-open"></i> ${deptName} Resources`;

    // Open full-page modal and load resources
    openDepartmentModal(department);
}

function openDepartmentModal(department) {
    const modal = document.getElementById('departmentModal');
    modal.classList.add('active');
    
    // Disable body scroll when modal is open
    document.body.style.overflow = 'hidden';
    
    currentDepartmentFilter = department;

    // Load past questions by default
    switchResourceType('past-questions');
}

function closeDepartmentModal() {
    const modal = document.getElementById('departmentModal');
    modal.classList.remove('active');
    
    // Re-enable body scroll
    document.body.style.overflow = '';
    
    document.getElementById('deptSearchInput').value = '';
}

function switchResourceType(type) {
    // Update tab styling
    document.querySelectorAll('.resource-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.style.color = 'rgba(255, 255, 255, 0.5)';
        tab.style.background = 'none';
    });

    event.target.classList.add('active');
    event.target.style.color = 'var(--primary)';

    // Show/hide content tabs
    if (type === 'past-questions') {
        document.getElementById('pastQuestionsTab').classList.add('active');
        document.getElementById('otherResourcesTab').classList.remove('active');
    } else {
        document.getElementById('pastQuestionsTab').classList.remove('active');
        document.getElementById('otherResourcesTab').classList.add('active');
    }

    // Load resources
    loadResourcesByType(type);
}

function loadResourcesByType(type) {
    const listId = type === 'past-questions' ? 'pastQuestionsList' : 'otherResourcesList';
    const list = document.getElementById(listId);

    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 40px; text-align: center;">Loading resources...</p>';

    // Use 'courses' collection
    let query = db.collection('courses');

    // Filter by department if specified
    if (currentDepartmentFilter) {
        query = query.where('department', '==', currentDepartmentFilter);
    }

    // Get all documents
    query.get().then(snapshot => {
        if (snapshot.empty) {
            list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 40px; text-align: center;">No resources found</p>';
            return;
        }

        // Filter by type and sort manually
        const resources = [];
        snapshot.forEach(doc => {
            const data = doc.data();
            if (type === 'past-questions' && data.category === 'past-questions') {
                resources.push({ id: doc.id, data: data });
            } else if (type === 'other' && data.category !== 'past-questions') {
                resources.push({ id: doc.id, data: data });
            }
        });

        if (resources.length === 0) {
            list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 40px; text-align: center;">No resources found in this category</p>';
            return;
        }

        // Sort by uploadedDate (newest first)
        resources.sort((a, b) => {
            const dateA = a.data.uploadedDate ? a.data.uploadedDate.toDate() : new Date(0);
            const dateB = b.data.uploadedDate ? b.data.uploadedDate.toDate() : new Date(0);
            return dateB - dateA;
        });

        // Display resources
        list.innerHTML = '';
        resources.forEach(resource => {
            const data = resource.data;
            const uploadedDate = data.uploadedDate ? new Date(data.uploadedDate.toDate()).toLocaleString() : 'N/A';

            // FORCE HTTPS FOR FILE URLs
            const rawFileUrl = data.firebaseStorageUrl || data.cloudinaryUrl || '';
            const fileUrl = ensureHttps(rawFileUrl);
            const fileName = data.name || data.fileName || 'download';

            const div = document.createElement('div');
            div.className = 'resource-item';
            div.setAttribute('data-title', data.title.toLowerCase());
            div.setAttribute('data-description', (data.description || '').toLowerCase());
            div.innerHTML = `
                <h4><i class="fas fa-file-alt"></i> ${data.title}</h4>
                <p><strong>Department:</strong> ${getDepartmentFullName(data.department)}</p>
                <p>${data.description || 'No description available'}</p>
                <div>
                    <span class="category-badge">${data.category.toUpperCase().replace('-', ' ')}</span>
                    <span class="category-badge"><i class="fas fa-file"></i> ${fileName}</span>
                    ${data.size ? `<span class="category-badge"><i class="fas fa-database"></i> ${data.size}</span>` : ''}
                </div>
                <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5); margin-top: 10px;">
                    <i class="fas fa-clock"></i> Posted: ${uploadedDate}
                </p>
                ${fileUrl ? `
                    <div class="resource-actions">
                        <button class="resource-btn" onclick="viewFile('${fileUrl.replace(/'/g, "\\'")}', '${fileName.replace(/'/g, "\\'")}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="resource-btn" onclick="downloadFile('${fileUrl.replace(/'/g, "\\'")}', '${fileName.replace(/'/g, "\\'")}')">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="resource-btn secondary" onclick="shareFile('${data.department}', '${fileName.replace(/'/g, "\\'")}', '${data.title.replace(/'/g, "\\'")}')">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                ` : '<p style="color: #ff6666; margin-top: 10px;"><i class="fas fa-exclamation-triangle"></i> File URL not available</p>'}
            `;
            list.appendChild(div);
        });
    }).catch(error => {
        console.error('Error loading resources:', error);
        list.innerHTML = `<p style="color: #ff6666; padding: 40px; text-align: center;">Error loading resources: ${error.message}</p>`;
    });
}

function searchDepartmentResources() {
    const searchTerm = document.getElementById('deptSearchInput').value.toLowerCase();
    const activeTab = document.querySelector('.resource-tab.active').textContent.includes('Past') ? 'past-questions' : 'other';
    const listId = activeTab === 'past-questions' ? 'pastQuestionsList' : 'otherResourcesList';

    const items = document.querySelectorAll(`#${listId} .resource-item`);

    items.forEach(item => {
        const title = item.getAttribute('data-title') || '';
        const description = item.getAttribute('data-description') || '';

        if (title.includes(searchTerm) || description.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

// ==================== ENHANCED FILE VIEWER - FIXED ====================
async function viewFile(fileUrl, fileName) {
    const modal = document.getElementById('fileViewerModal');
    const title = document.getElementById('fileViewerTitle');
    const content = document.getElementById('fileContentDisplay');

    // Ensure HTTPS
    const secureUrl = ensureHttps(fileUrl);

    title.textContent = fileName;
    content.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>Loading file...</p></div>';
    modal.classList.add('active');
    
    // Disable body scroll
    document.body.style.overflow = 'hidden';

    try {
        // Check file type
        const fileExt = fileName.toLowerCase().split('.').pop();
        const textExtensions = ['txt', 'md', 'csv', 'json', 'xml', 'log'];
        
        if (textExtensions.includes(fileExt)) {
            // Try to fetch and display text
            const response = await fetch(secureUrl);
            
            if (!response.ok) {
                throw new Error('Failed to fetch file');
            }
            
            const text = await response.text();
            content.textContent = text;
            updateFileView();
        } else {
            // For PDFs, images, and other files, use iframe or direct link
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
                        <i class="fas fa-file" style="font-size: 3rem; color: var(--primary);"></i>
                    </p>
                    <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px;">
                        Preview not available for this file type.
                    </p>
                    <a href="${secureUrl}" target="_blank" rel="noopener noreferrer" 
                       style="display: inline-block; padding: 12px 24px; background: var(--primary); color: #fff; text-decoration: none; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-external-link-alt"></i> Open in New Tab
                    </a>
                </div>
            `;
        }
    } catch (error) {
        console.error('View file error:', error);
        content.innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <p style="color: #ff6666; margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
                </p>
                <p style="color: #ff6666; margin-bottom: 20px;">
                    Error loading file preview.
                </p>
                <a href="${secureUrl}" target="_blank" rel="noopener noreferrer" 
                   style="display: inline-block; padding: 12px 24px; background: var(--primary); color: #fff; text-decoration: none; border-radius: 8px; font-weight: 600;">
                    <i class="fas fa-external-link-alt"></i> Open in New Tab
                </a>
            </div>
        `;
    }
}

function closeFileViewer() {
    const modal = document.getElementById('fileViewerModal');
    modal.classList.remove('active');
    
    // Re-enable body scroll
    document.body.style.overflow = '';
}

function updateFileView() {
    const content = document.getElementById('fileContentDisplay');
    const fontFamily = document.getElementById('fontFamily').value;
    const fontSize = document.getElementById('fontSize').value + 'px';

    content.style.fontFamily = fontFamily;
    content.style.fontSize = fontSize;
}

// ==================== TOAST NOTIFICATION SYSTEM ====================

let activeToasts = [];

function showToast(message, type = 'info', duration = 3000) {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;

    document.body.appendChild(toast);
    activeToasts.push(toast);

    setTimeout(() => {
        toast.classList.add('show');
    }, 10);

    if (duration > 0) {
        setTimeout(() => {
            hideToast(toast);
        }, duration);
    }

    return toast;
}

function hideToast(toast) {
    if (!toast || !toast.parentNode) return;

    toast.classList.remove('show');

    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);

            const index = activeToasts.indexOf(toast);
            if (index > -1) {
                activeToasts.splice(index, 1);
            }
        }
    }, 300);
}

function clearAllToasts() {
    activeToasts.forEach(toast => hideToast(toast));
    activeToasts = [];
}

// ==================== ENHANCED DOWNLOAD FUNCTION - FIXED ====================

async function downloadFile(fileUrl, fileName) {
    let loadingToast = null;

    try {
        // Ensure HTTPS
        const secureUrl = ensureHttps(fileUrl);
        
        loadingToast = showToast(' Preparing download...', 'info', 0);

        // For Cloudinary URLs, use direct download
        if (secureUrl.includes('cloudinary.com')) {
            // Modify URL to force download
            const downloadUrl = secureUrl.includes('/upload/') 
                ? secureUrl.replace('/upload/', '/upload/fl_attachment/')
                : secureUrl;
            
            // Create temporary link
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = fileName || 'download';
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            if (loadingToast) hideToast(loadingToast);
            showToast(` ${fileName} download started!`, 'success', 3000);
            trackDownload(fileName);
            return;
        }

        // For other URLs, try fetch method
        const response = await fetch(secureUrl);

        if (!response.ok) {
            throw new Error('Failed to fetch file');
        }

        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = blobUrl;
        link.download = fileName || 'download';
        link.style.display = 'none';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        setTimeout(() => {
            window.URL.revokeObjectURL(blobUrl);
        }, 100);

        if (loadingToast) hideToast(loadingToast);
        showToast(` ${fileName} downloaded successfully!`, 'success', 3000);
        trackDownload(fileName);

    } catch (error) {
        console.error('Download error:', error);

        if (loadingToast) hideToast(loadingToast);
        showToast(' Download failed. Opening in new tab...', 'error', 3000);

        setTimeout(() => {
            window.open(ensureHttps(fileUrl), '_blank');
        }, 1500);
    }
}

function trackDownload(fileName) {
    if (!currentUser) return;

    db.collection('downloads').add({
        userId: currentUser.uid,
        userName: currentUser.name,
        fileName: fileName,
        downloadedAt: firebase.firestore.FieldValue.serverTimestamp()
    }).catch(error => {
        console.error('Error tracking download:', error);
    });
}

// ==================== SHARE FUNCTION ====================

function shareFile(department, fileName, fileTitle) {
    const baseUrl = window.location.origin + window.location.pathname;
    const shareUrl = `${baseUrl}?dept=${encodeURIComponent(department)}&file=${encodeURIComponent(fileName)}&title=${encodeURIComponent(fileTitle)}`;

    const shareText = ` Check out this resource from FLASH100: ${fileTitle}`;

    if (navigator.share) {
        navigator.share({
            title: fileTitle,
            text: shareText,
            url: shareUrl
        }).then(() => {
            showToast(' Shared successfully!', 'success', 3000);
        }).catch(err => {
            if (err.name !== 'AbortError') {
                copyToClipboardEnhanced(shareUrl, shareText);
            }
        });
    } else {
        copyToClipboardEnhanced(shareUrl, shareText);
    }
}

function copyToClipboardEnhanced(url, message) {
    const fullText = `${message}\n\n${url}`;

    navigator.clipboard.writeText(fullText).then(() => {
        showToast(' Link copied to clipboard!', 'success', 3000);
    }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = fullText;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            showToast(' Link copied to clipboard!', 'success', 3000);
        } catch (err) {
            prompt('Copy this link:', fullText);
        }

        document.body.removeChild(textArea);
    });
}

// ==================== TOAST STYLES ====================

const toastStyles = `
.toast {
    position: fixed;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    color: var(--dark);
    padding: clamp(12px, 3vw, 15px) clamp(20px, 5vw, 25px);
    border-radius: 50px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    font-weight: 600;
    font-size: clamp(0.85rem, 2vw, 0.95rem);
    z-index: 10000;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 140, 0, 0.3);
    max-width: 90%;
    text-align: center;
    pointer-events: none;
}

.toast.show {
    bottom: clamp(20px, 5vw, 30px);
    animation: toastSlideIn 0.3s ease-out;
}

@keyframes toastSlideIn {
    from {
        bottom: -100px;
        opacity: 0;
    }
    to {
        bottom: clamp(20px, 5vw, 30px);
        opacity: 1;
    }
}

.toast-success {
    background: linear-gradient(135deg, rgba(81, 207, 102, 0.95) 0%, rgba(55, 178, 77, 0.95) 100%);
    color: white;
    border-color: rgba(81, 207, 102, 0.5);
}

.toast-error {
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.95) 0%, rgba(255, 71, 87, 0.95) 100%);
    color: white;
    border-color: rgba(255, 107, 107, 0.5);
}

.toast-info {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
    color: white;
    border-color: rgba(102, 126, 234, 0.5);
}

.toast:nth-child(2) { bottom: clamp(80px, 15vw, 90px); }
.toast:nth-child(3) { bottom: clamp(140px, 25vw, 150px); }

@media (max-width: 480px) {
    .toast {
        font-size: 0.85rem;
        padding: 12px 20px;
        max-width: 85%;
        border-radius: 40px;
    }
    
    .toast.show {
        bottom: 20px;
    }
    
    .toast:nth-child(2) { bottom: 80px; }
    .toast:nth-child(3) { bottom: 140px; }
}
`;

(function injectToastStyles() {
    if (!document.getElementById('toast-styles')) {
        const style = document.createElement('style');
        style.id = 'toast-styles';
        style.textContent = toastStyles;
        document.head.appendChild(style);
    }
})();

// ==================== ADMIN UPLOAD - FIXED ====================

function uploadResource() {
    const dept = document.getElementById('uploadDepartment').value;
    const title = document.getElementById('uploadTitle').value;
    const desc = document.getElementById('uploadDescription').value;
    const category = document.getElementById('uploadCategory').value;
    const fileInput = document.getElementById('uploadFile');

    if (!dept || !title || !desc || !category || !fileInput.files[0]) {
        showToast('Please fill in all fields and select a file', 'error', 3000);
        return;
    }

    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

    const originalFileName = file.name;
    const fileSize = (file.size / 1024 / 1024).toFixed(2) + ' MB';

    showToast('Uploading... Please wait', 'info', 0);

    fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`, {
        method: 'POST',
        body: formData
    })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error.message);
            }

            // FORCE HTTPS for Cloudinary URL
            const secureUrl = ensureHttps(data.secure_url);

            return db.collection('courses').add({
                department: dept,
                title: title,
                description: desc,
                category: category,
                name: originalFileName,
                fileName: originalFileName,
                size: fileSize,
                cloudinaryUrl: secureUrl,
                uploadedDate: firebase.firestore.FieldValue.serverTimestamp(),
                uploadedBy: 'admin'
            });
        })
        .then(() => {
            clearAllToasts();
            showToast(' Resource uploaded successfully!', 'success', 3000);
            document.getElementById('uploadDepartment').value = '';
            document.getElementById('uploadTitle').value = '';
            document.getElementById('uploadDescription').value = '';
            document.getElementById('uploadCategory').value = 'past-questions';
            document.getElementById('uploadFile').value = '';
            loadAdminStats();
            loadUploadedResources();
        })
        .catch(error => {
            clearAllToasts();
            showToast('Error: ' + error.message, 'error', 4000);
        });
}

// ==================== LOAD UPLOADED RESOURCES ====================

function loadUploadedResources() {
    const container = document.getElementById('uploadedResourcesList');
    if (!container) return;

    container.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading resources...</p>';

    db.collection('courses')
        .orderBy('uploadedDate', 'desc')
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                container.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No resources uploaded yet</p>';
                return;
            }

            container.innerHTML = '';

            snapshot.forEach(doc => {
                const data = doc.data();
                const docId = doc.id;
                const uploadedDate = data.uploadedDate ? new Date(data.uploadedDate.toDate()).toLocaleString() : 'N/A';
                
                // Ensure HTTPS
                const secureUrl = ensureHttps(data.cloudinaryUrl || data.firebaseStorageUrl || '');

                const div = document.createElement('div');
                div.className = 'resource-item';
                div.style.cssText = 'margin-bottom: 20px; position: relative;';
                div.innerHTML = `
                    <h4 style="color: var(--primary); margin-bottom: 10px;">
                        <i class="fas fa-file-alt"></i> ${data.title}
                    </h4>
                    <p><strong>Department:</strong> ${getDepartmentFullName(data.department)}</p>
                    <p><strong>Category:</strong> ${data.category.replace('-', ' ').toUpperCase()}</p>
                    <p>${data.description || 'No description'}</p>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5); margin-top: 10px;">
                        <i class="fas fa-clock"></i> Uploaded: ${uploadedDate}
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="resource-btn" onclick="editResource('${docId}', '${data.title.replace(/'/g, "\\'")}', '${(data.description || '').replace(/'/g, "\\'")}', '${data.department}', '${data.category}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="resource-btn" style="background: var(--danger);" onclick="deleteResource('${docId}', '${data.title.replace(/'/g, "\\'")}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button class="resource-btn secondary" onclick="viewFile('${secureUrl}', '${data.fileName}')">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        })
        .catch(error => {
            console.error('Error loading resources:', error);
            container.innerHTML = `<p style="color: #ff6666; padding: 20px;">Error: ${error.message}</p>`;
        });
}

function editResource(docId, currentTitle, currentDesc, currentDept, currentCategory) {
    const newTitle = prompt('Edit Title:', currentTitle);
    if (!newTitle || newTitle === currentTitle) {
        const newDesc = prompt('Edit Description:', currentDesc);
        if (!newDesc) return;

        db.collection('courses').doc(docId).update({
            description: newDesc,
            lastModified: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            showToast(' Resource updated!', 'success', 3000);
            loadUploadedResources();
        }).catch(error => {
            showToast('Error: ' + error.message, 'error', 3000);
        });
        return;
    }

    db.collection('courses').doc(docId).update({
        title: newTitle,
        lastModified: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        showToast(' Resource updated!', 'success', 3000);
        loadUploadedResources();
    }).catch(error => {
        showToast('Error: ' + error.message, 'error', 3000);
    });
}

function deleteResource(docId, title) {
    if (!confirm(`Delete "${title}"? This cannot be undone!`)) return;

    db.collection('courses').doc(docId).delete()
        .then(() => {
            showToast(' Resource deleted!', 'success', 3000);
            loadUploadedResources();
            loadAdminStats();
        })
        .catch(error => {
            showToast('Error: ' + error.message, 'error', 3000);
        });
}

// ==================== COURSE OUTLINE FUNCTIONS ====================

function addCourseOutline() {
    const dept = document.getElementById('adminOutlineDepartment').value;
    const course = document.getElementById('adminOutlineCourseName').value;
    const content = document.getElementById('adminOutlineContent').value;

    if (!dept || !course || !content) {
        showToast('Please fill in all fields', 'error', 2000);
        return;
    }

    const weeks = parseOutlineContent(content);

    if (weeks.length === 0) {
        showToast('No weeks found. Format: Week 1: Topic...', 'error', 3000);
        return;
    }

    const batch = db.batch();

    weeks.forEach(week => {
        const docRef = db.collection('course_outlines').doc();
        batch.set(docRef, {
            department: dept,
            courseName: course,
            week: week.number,
            topics: week.content,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
    });

    batch.commit()
        .then(() => {
            showToast(` ${weeks.length} weeks added for ${course}!`, 'success', 3000);
            document.getElementById('adminOutlineDepartment').value = '';
            document.getElementById('adminOutlineCourseName').value = '';
            document.getElementById('adminOutlineContent').value = '';
            loadExistingOutlines();
        })
        .catch(error => {
            showToast('Error: ' + error.message, 'error', 3000);
        });
}

function parseOutlineContent(content) {
    const weeks = [];
    const lines = content.split(/Week\s+(\d+)/i);

    for (let i = 1; i < lines.length; i += 2) {
        const weekNumber = parseInt(lines[i]);
        const weekContent = lines[i + 1] ? lines[i + 1].trim().replace(/^:\s*/, '') : '';

        if (weekNumber && weekContent) {
            weeks.push({
                number: weekNumber,
                content: weekContent
            });
        }
    }

    return weeks;
}

function loadExistingOutlines() {
    const list = document.getElementById('existingOutlines');
    if (!list) return;

    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('course_outlines')
        .orderBy('createdAt', 'desc')
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No outlines yet</p>';
                return;
            }

            const courses = {};
            snapshot.forEach(doc => {
                const data = doc.data();
                const key = `${data.department}_${data.courseName}`;

                if (!courses[key]) {
                    courses[key] = {
                        department: data.department,
                        courseName: data.courseName,
                        weeks: []
                    };
                }

                courses[key].weeks.push({
                    id: doc.id,
                    week: data.week,
                    topics: data.topics
                });
            });

            list.innerHTML = '';

            Object.keys(courses).forEach(key => {
                const course = courses[key];
                course.weeks.sort((a, b) => a.week - b.week);

                const courseDiv = document.createElement('div');
                courseDiv.style.cssText = 'margin-bottom: 30px; background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 140, 0, 0.2);';

                let html = `
                    <h3 style="color: var(--primary); margin-bottom: 15px; font-family: var(--font-display);">
                        ${getDepartmentFullName(course.department)} - ${course.courseName}
                    </h3>
                    <button onclick="deleteCourseOutline('${course.department}', '${course.courseName}')"
                        style="padding: 8px 16px; background: rgba(255, 107, 107, 0.2); color: #ff6b6b; border: 1px solid #ff6b6b; border-radius: 6px; cursor: pointer; margin-bottom: 15px;">
                        <i class="fas fa-trash"></i> Delete All Weeks
                    </button>
                `;

                course.weeks.forEach(week => {
                    html += `
                        <div class="outline-item" style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div class="outline-week">Week ${week.week}</div>
                                <div class="outline-topics">${week.topics}</div>
                            </div>
                            <button onclick="deleteWeekOutline('${week.id}')"
                                style="padding: 6px 12px; background: rgba(255, 107, 107, 0.2); color: #ff6b6b; border: 1px solid #ff6b6b; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                });

                courseDiv.innerHTML = html;
                list.appendChild(courseDiv);
            });
        })
        .catch(error => {
            console.error('Error loading outlines:', error);
            list.innerHTML = `<p style="color: #ff6666; padding: 20px;">Error: ${error.message}</p>`;
        });
}

function deleteCourseOutline(department, courseName) {
    if (!confirm(`Delete all weeks for ${courseName}? This cannot be undone!`)) return;

    db.collection('course_outlines')
        .where('department', '==', department)
        .where('courseName', '==', courseName)
        .get()
        .then(snapshot => {
            const batch = db.batch();
            snapshot.forEach(doc => {
                batch.delete(doc.ref);
            });
            return batch.commit();
        })
        .then(() => {
            showToast(' Course outline deleted!', 'success', 3000);
            loadExistingOutlines();
        })
        .catch(error => {
            showToast('Error: ' + error.message, 'error', 3000);
        });
}

function deleteWeekOutline(docId) {
    if (!confirm('Delete this week?')) return;

    db.collection('course_outlines').doc(docId).delete()
        .then(() => {
            showToast(' Week deleted!', 'success', 3000);
            loadExistingOutlines();
        })
        .catch(error => {
            showToast('Error: ' + error.message, 'error', 3000);
        });
}

function loadCourseOutlines() {
    if (!currentUser) return;

    const list = document.getElementById('outlinesList');
    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('course_outlines')
        .where('department', '==', currentUser.department)
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No course outlines available yet</p>';
            } else {
                const courses = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!courses[data.courseName]) {
                        courses[data.courseName] = [];
                    }
                    courses[data.courseName].push(data);
                });

                list.innerHTML = '';

                Object.keys(courses).forEach(courseName => {
                    const courseDiv = document.createElement('div');
                    courseDiv.style.cssText = 'margin-bottom: 30px;';

                    const courseTitle = document.createElement('h3');
                    courseTitle.style.cssText = 'color: var(--primary); font-family: var(--font-display); font-size: 1.5rem; margin-bottom: 15px;';
                    courseTitle.innerHTML = `<i class="fas fa-book"></i> ${courseName}`;
                    courseDiv.appendChild(courseTitle);

                    courses[courseName].sort((a, b) => a.week - b.week);

                    courses[courseName].forEach(outline => {
                        const item = document.createElement('div');
                        item.className = 'outline-item';
                        item.innerHTML = `
                            <div class="outline-week">Week ${outline.week}</div>
                            <div class="outline-topics">${outline.topics}</div>
                        `;
                        courseDiv.appendChild(item);
                    });

                    list.appendChild(courseDiv);
                });
            }
        })
        .catch(error => {
            console.error('Error loading outlines:', error);
            list.innerHTML = `<p style="color: #ff6666; padding: 20px;">Error loading outlines: ${error.message}</p>`;
        });
}

// ==================== STUDY TIMER ====================
let timerInterval = null;
let timerSeconds = 25 * 60;
let isBreak = false;
let sessionsCompleted = 0;

function updateTimerDisplay() {
    const minutes = Math.floor(timerSeconds / 60);
    const seconds = timerSeconds % 60;
    document.getElementById('timerDisplay').textContent =
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function startTimer() {
    if (timerInterval) return;

    timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();

        if (timerSeconds <= 0) {
            clearInterval(timerInterval);
            timerInterval = null;

            if (!isBreak) {
                sessionsCompleted++;
                document.getElementById('sessionsCompleted').textContent = sessionsCompleted;
                saveStudySession();
                alert(' Focus session complete! Time for a 5-minute break!');
                isBreak = true;
                timerSeconds = 5 * 60;
            } else {
                alert(' Break time over! Ready for another focus session?');
                isBreak = false;
                timerSeconds = 25 * 60;
            }

            updateTimerDisplay();
        }
    }, 1000);
}

function pauseTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

function resetTimer() {
    pauseTimer();
    isBreak = false;
    timerSeconds = 25 * 60;
    updateTimerDisplay();
}

function saveStudySession() {
    if (!currentUser) return;

    db.collection('study_sessions').add({
        userId: currentUser.uid,
        duration: 25,
        completedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
}

function loadStudyStats() {
    if (!currentUser) return;

    const statsContainer = document.getElementById('studyStats');
    statsContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5);">Loading stats...</p>';

    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);

    db.collection('study_sessions')
        .where('userId', '==', currentUser.uid)
        .where('completedAt', '>=', weekAgo)
        .get()
        .then(snapshot => {
            const totalSessions = snapshot.size;
            const totalMinutes = totalSessions * 25;
            const totalHours = (totalMinutes / 60).toFixed(1);

            statsContainer.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="text-align: center; padding: 20px; background: rgba(255, 140, 0, 0.1); border-radius: 12px;">
                    <h3 style="font-size: 2.5rem; color: var(--primary); margin-bottom: 5px;">${totalSessions}</h3>
                    <p style="color: rgba(255, 255, 255, 0.7);">Sessions This Week</p>
                </div>
                <div style="text-align: center; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
                    <h3 style="font-size: 2.5rem; color: var(--secondary); margin-bottom: 5px;">${totalHours}h</h3>
                    <p style="color: rgba(255, 255, 255, 0.7);">Total Study Time</p>
                </div>
                <div style="text-align: center; padding: 20px; background: rgba(81, 207, 102, 0.1); border-radius: 12px;">
                    <h3 style="font-size: 2.5rem; color: var(--accent); margin-bottom: 5px;">${Math.round(totalSessions / 7)}</h3>
                    <p style="color: rgba(255, 255, 255, 0.7);">Daily Average</p>
                </div>
            </div>
        `;
        });
}

// ==================== COMMUNITY ====================
function loadCommunities() {
    const grid = document.getElementById('communityGrid');

    const departments = [
        { id: 'history', name: 'History', icon: '' },
        { id: 'iss', name: 'International Studies', icon: '' },
        { id: 'french', name: 'French', icon: '' },
        { id: 'portuguese', name: 'Portuguese', icon: '' },
        { id: 'linguistics', name: 'Linguistics', icon: '' },
        { id: 'philosophy', name: 'Philosophy', icon: '' },
        { id: 'theatre-art', name: 'Theatre Art', icon: '' },
        { id: 'gns', name: 'General Studies', icon: '' },
        { id: 'english', name: 'English', icon: '' },
        { id: 'peace-studies', name: 'Peace Studies', icon: '' }
    ];

    grid.innerHTML = '';

    departments.forEach(dept => {
        db.collection('students').where('department', '==', dept.id).get().then(snapshot => {
            const memberCount = snapshot.size;

            db.collection('community_posts').where('department', '==', dept.id).get().then(postSnapshot => {
                const postCount = postSnapshot.size;

                const card = document.createElement('div');
                card.className = 'community-card';
                card.onclick = () => switchToDepartmentCommunity(dept.id);
                card.innerHTML = `
                <span class="community-icon">${dept.icon}</span>
                <h4 class="community-name">${dept.name}</h4>
                <div class="community-stats">
                    <span><i class="fas fa-users"></i> ${memberCount} members</span>
                    <span><i class="fas fa-comments"></i> ${postCount} posts</span>
                </div>
            `;
                grid.appendChild(card);
            });
        });
    });
}

function switchToDepartmentCommunity(deptId) {
    loadCommunityFeed(deptId);
    switchNavTab('community');
}

function createPost() {
    const content = document.getElementById('newPostContent').value.trim();

    if (!content) {
        alert('Please write something to post');
        return;
    }

    db.collection('community_posts').add({
        userId: currentUser.uid,
        userName: currentUser.name,
        userMatric: currentUser.matric,
        department: currentUser.department,
        content: content,
        likes: 0,
        comments: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        document.getElementById('newPostContent').value = '';
        loadCommunityFeed();
        alert(' Post created successfully!');
    }).catch(error => {
        alert('Error: ' + error.message);
    });
}

function loadCommunityFeed(filterDept = null) {
    const feed = document.getElementById('communityFeed');
    feed.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading feed...</p>';

    let query = db.collection('community_posts');

    if (filterDept) {
        query = query.where('department', '==', filterDept);
    }

    query.orderBy('createdAt', 'desc').limit(20).get().then(snapshot => {
        if (snapshot.empty) {
            feed.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No posts yet. Be the first to post!</p>';
        } else {
            feed.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const postId = doc.id;

                const post = document.createElement('div');
                post.className = 'post';
                post.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${data.userName.charAt(0).toUpperCase()}</div>
                    <div class="post-meta">
                        <div class="post-author">${data.userName}</div>
                        <div class="post-time">
                            ${getDepartmentFullName(data.department)}  
                            ${data.createdAt ? new Date(data.createdAt.toDate()).toLocaleString() : 'Just now'}
                        </div>
                    </div>
                </div>
                <div class="post-content">${data.content}</div>
                <div class="post-actions">
                    <button class="post-action-btn" onclick="likePost('${postId}')">
                        <i class="fas fa-heart"></i> ${data.likes || 0}
                    </button>
                    <button class="post-action-btn">
                        <i class="fas fa-comment"></i> ${data.comments || 0}
                    </button>
                    <button class="post-action-btn">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            `;
                feed.appendChild(post);
            });
        }
    });
}

function likePost(postId) {
    db.collection('community_posts').doc(postId).update({
        likes: firebase.firestore.FieldValue.increment(1)
    }).then(() => {
        loadCommunityFeed();
    });
}

// ==================== ADMIN FUNCTIONS ====================
function loadAdminStats() {
    db.collection('students').get().then(snapshot => {
        document.getElementById('totalUsers').textContent = snapshot.size;
    });

    db.collection('courses').get().then(snapshot => {
        document.getElementById('totalResources').textContent = snapshot.size;
    });

    db.collection('community_posts').get().then(snapshot => {
        document.getElementById('totalPosts').textContent = snapshot.size;
    });
}

function loadUsers() {
    const list = document.getElementById('usersList');
    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('students').orderBy('registeredDate', 'desc').get().then(snapshot => {
        if (snapshot.empty) {
            list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No users yet</p>';
        } else {
            list.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 5px;">${data.name}</h4>
                        <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">
                            <i class="fas fa-id-card"></i> ${data.matric} | 
                            <i class="fas fa-envelope"></i> ${data.email}
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">
                            <i class="fas fa-building"></i> ${getDepartmentFullName(data.department)}
                        </p>
                    </div>
                </div>
            `;
                list.appendChild(div);
            });
        }
    });
}

function loadFeedback() {
    const list = document.getElementById('feedbackList');
    list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">Loading...</p>';

    db.collection('feedback').orderBy('submittedAt', 'desc').get().then(snapshot => {
        if (snapshot.empty) {
            list.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); padding: 20px;">No feedback yet</p>';
        } else {
            list.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                <h4 style="color: var(--primary); margin-bottom: 10px;">${data.subject || 'Feedback'}</h4>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 10px; line-height: 1.6;">${data.message}</p>
                <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5);">
                    From: ${data.userName} (${data.userMatric}) - 
                    ${data.submittedAt ? new Date(data.submittedAt.toDate()).toLocaleString() : 'Just now'}
                </p>
            `;
                list.appendChild(div);
            });
        }
    });
}

// ==================== AI CHAT PLACEHOLDERS ====================
function loadAIConversations() {}
function clearAIChat() {
    const messagesContainer = document.getElementById('aiChatMessages');
    if (messagesContainer) {
        messagesContainer.innerHTML = '';
    }
}
function sendAIMessage() {
    const input = document.getElementById('aiChatInput');
    if (input && input.value.trim()) {
        alert('AI chat feature coming soon!');
        input.value = '';
    }
}
function handleAIChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendAIMessage();
    }
}

// Initialize timer display
updateTimerDisplay();
   

    </script>
</body>
</html>
